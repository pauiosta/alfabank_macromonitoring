import os
import re
from datetime import datetime
from pathlib import Path
from typing import Dict, Iterable, List, Optional, Set, Tuple

import pandas as pd
import pyodbc
import requests
BASE_URL = "https://cbr.ru/dataservice"
YEAR_FROM = 2010
YEAR_TO = 2025


def get_publications():
    url = f"{BASE_URL}/publications"
    response = requests.get(url)
    response.raise_for_status()
    return [p for p in response.json() if p.get("NoActive") != 1]  # –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤—ã–≤–∞–µ–º –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–µ

def get_datasets(publication_id):
    url = f"{BASE_URL}/datasets"
    response = requests.get(url, params={"publicationId": publication_id})
    response.raise_for_status()
    return response.json()

def get_measures(dataset_id):
    url = f"{BASE_URL}/measures"
    response = requests.get(url, params={"datasetId": dataset_id})
    response.raise_for_status()
    return response.json().get("measure", [])

def get_data(y1, y2, dataset_id, publication_id, measure_id=None):
    url = f"{BASE_URL}/data"
    params = {
        "y1": y1,
        "y2": y2,
        "datasetId": dataset_id,
        "publicationId": publication_id
    }
    if measure_id is not None:
        params["measureId"] = measure_id
    response = requests.get(url, params=params)
    response.raise_for_status()
    return response.json()

def abbr(text):
    return ''.join([w[:3] for w in re.findall(r'\w+', text)])[:15]


TABLE_PREFIX = os.getenv("CBR_TABLE_PREFIX", "cbr")
HADOOP_DSN = os.getenv("CBR_HADOOP_DSN", "impala51")
HADOOP_DATABASE = os.getenv("CBR_HADOOP_DATABASE", "u_cbr")
PARQUET_COMPRESSION = os.getenv("CBR_PARQUET_COMPRESSION", "SNAPPY")
RECREATE_TABLES = os.getenv("CBR_RECREATE_TABLES", "true").lower() == "true"
BATCH_SIZE = int(os.getenv("CBR_BATCH_SIZE", "1000"))
DICTIONARY_PATH = Path(os.getenv("CBR_DICTIONARY_PATH", "cbr_name_dictionary.csv"))
METADATA_TABLE_NAME = os.getenv("CBR_METADATA_TABLE", f"{TABLE_PREFIX}_metadata")
IDENTIFIER_MAX_LENGTH = 96
COLUMN_IDENTIFIER_MAX_LENGTH = 64


CYRILLIC_TO_LATIN: Dict[str, str] = {
    "–∞": "a",
    "–±": "b",
    "–≤": "v",
    "–≥": "g",
    "–¥": "d",
    "–µ": "e",
    "—ë": "e",
    "–∂": "zh",
    "–∑": "z",
    "–∏": "i",
    "–π": "y",
    "–∫": "k",
    "–ª": "l",
    "–º": "m",
    "–Ω": "n",
    "–æ": "o",
    "–ø": "p",
    "—Ä": "r",
    "—Å": "s",
    "—Ç": "t",
    "—É": "u",
    "—Ñ": "f",
    "—Ö": "h",
    "—Ü": "ts",
    "—á": "ch",
    "—à": "sh",
    "—â": "sch",
    "—ä": "",
    "—ã": "y",
    "—å": "",
    "—ç": "e",
    "—é": "yu",
    "—è": "ya",
}


def transliterate(text: Optional[str]) -> str:
    if not text:
        return ""

    result = []
    for char in text.lower():
        if char in CYRILLIC_TO_LATIN:
            result.append(CYRILLIC_TO_LATIN[char])
        elif char.isascii():
            result.append(char)
        elif char.isdigit():
            result.append(char)
        else:
            # fallback: replace with underscore for unsupported characters
            result.append("_")
    return "".join(result)


def normalize_identifier(raw_value: Optional[str], max_length: int = IDENTIFIER_MAX_LENGTH) -> str:
    value = transliterate(raw_value)
    value = re.sub(r"[^0-9a-z_]+", "_", value)
    value = re.sub(r"_+", "_", value)
    value = value.strip("_")
    if not value:
        value = "value"
    if value[0].isdigit():
        value = f"_{value}"
    if len(value) > max_length:
        value = value[:max_length]
        value = value.rstrip("_") or value
    return value


def quote_identifier(identifier: str) -> str:
    return f"`{identifier}`"


def ensure_database(cursor: pyodbc.Cursor, schema: str) -> None:
    cursor.execute(f"CREATE DATABASE IF NOT EXISTS {quote_identifier(schema)}")


def map_dtype(dtype: pd.api.extensions.ExtensionDtype) -> str:
    if pd.api.types.is_bool_dtype(dtype):
        return "BOOLEAN"
    if pd.api.types.is_integer_dtype(dtype):
        return "BIGINT"
    if pd.api.types.is_float_dtype(dtype):
        return "DOUBLE"
    if pd.api.types.is_datetime64_any_dtype(dtype):
        return "TIMESTAMP"
    if pd.api.types.is_string_dtype(dtype):
        return "STRING"
    return "STRING"


def fully_qualified_name(schema: str, table: str) -> str:
    return f"{quote_identifier(schema)}.{quote_identifier(table)}"


def create_impala_table(cursor: pyodbc.Cursor, schema: str, table: str, df: pd.DataFrame) -> None:
    qualified = fully_qualified_name(schema, table)
    if RECREATE_TABLES:
        cursor.execute(f"DROP TABLE IF EXISTS {qualified}")

    columns_ddl = []
    for column, dtype in df.dtypes.items():
        sql_type = map_dtype(dtype)
        columns_ddl.append(f"{quote_identifier(column)} {sql_type}")

    columns_sql = ",\n        ".join(columns_ddl)
    ddl = (
        f"CREATE TABLE IF NOT EXISTS {qualified} (\n"
        f"        {columns_sql}\n"
        ")\n"
        "STORED AS PARQUET\n"
        f"TBLPROPERTIES ('transactional'='false', 'parquet.compression'='{PARQUET_COMPRESSION}')"
    )
    cursor.execute(ddl)


def insert_dataframe(
    cursor: pyodbc.Cursor,
    schema: str,
    table: str,
    df: pd.DataFrame,
    batch_size: int = BATCH_SIZE,
) -> None:
    if df.empty:
        return

    qualified = fully_qualified_name(schema, table)
    placeholders = ", ".join(["?"] * len(df.columns))
    column_clause = ", ".join(quote_identifier(col) for col in df.columns)
    insert_sql = f"INSERT INTO {qualified} ({column_clause}) VALUES ({placeholders})"

    cursor.fast_executemany = True

    total_rows = len(df)
    for start in range(0, total_rows, batch_size):
        end = min(start + batch_size, total_rows)
        batch = df.iloc[start:end]
        data = []
        for row in batch.itertuples(index=False, name=None):
            prepared = []
            for value in row:
                missing = False
                if value is None:
                    missing = True
                else:
                    try:
                        missing = pd.isna(value)
                    except TypeError:
                        missing = False

                if missing:
                    prepared.append(None)
                    continue

                if isinstance(value, pd.Timestamp):
                    prepared.append(value.to_pydatetime())
                else:
                    prepared.append(value)
            data.append(tuple(prepared))

        if data:
            cursor.executemany(insert_sql, data)


COLUMN_OVERRIDES: Dict[str, str] = {
    "obs_val": "observation_value",
    "indicator_name": "indicator_name",
    "element_id": "element_id",
    "element_name": "element_name",
    "measure_id": "measure_id",
    "measure_name": "measure_name",
    "measure_id_requested": "requested_measure_id",
    "publication_id": "publication_id",
    "publication_name": "publication_name",
    "dataset_id": "dataset_id",
    "dataset_name": "dataset_name",
    "unit_id": "unit_id",
    "unit_name": "unit_name",
    "table_alias": "table_alias",
}


def rename_columns_with_translation(
    df: pd.DataFrame,
    table_name: str,
    dictionary_records: List[Dict[str, object]],
    context: Dict[str, object],
    dictionary_seen: Set[Tuple[str, str]],
) -> pd.DataFrame:
    assigned: Dict[str, int] = {}
    rename_map: Dict[str, str] = {}

    for original in df.columns:
        candidate = COLUMN_OVERRIDES.get(original)
        if candidate is None:
            candidate = normalize_identifier(original, COLUMN_IDENTIFIER_MAX_LENGTH)

        base = candidate
        suffix = 1
        while candidate in assigned:
            suffix += 1
            candidate = f"{base}_{suffix}"

        assigned[candidate] = 1
        rename_map[original] = candidate

        key = (table_name, candidate)
        if key not in dictionary_seen:
            dictionary_records.append(
                {
                    **context,
                    "entity_type": "column",
                    "table_name": table_name,
                    "column_name": candidate,
                    "english_name": candidate,
                    "russian_name": original,
                }
            )
            dictionary_seen.add(key)

    return df.rename(columns=rename_map)


def build_table_name(
    dataset_name: str,
    measure_label: Optional[str],
    dataset_id: int,
    measure_id: Optional[int],
    used_names: Set[str],
) -> str:
    parts = [TABLE_PREFIX, dataset_name]
    if measure_label:
        parts.append(measure_label)
    suffix = "all" if measure_id is None else f"m{measure_id}"
    parts.append(suffix)

    base = normalize_identifier("_".join(filter(None, parts)))
    if not base:
        base = f"{TABLE_PREFIX}_dataset_{dataset_id}_{suffix}"

    candidate = base
    counter = 1
    while candidate in used_names:
        counter += 1
        candidate = normalize_identifier(f"{base}_{counter}")

    if len(candidate) > IDENTIFIER_MAX_LENGTH:
        candidate = candidate[:IDENTIFIER_MAX_LENGTH]

    used_names.add(candidate)
    return candidate


def connect_impala() -> pyodbc.Connection:
    return pyodbc.connect(
        f"DSN={HADOOP_DSN};",
        autocommit=True,
        ansi=True,
        timeout=0,
    )

# –¢–û–õ–¨–ö–û –Ω—É–∂–Ω—ã–µ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –∏ –∏—Ö –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏
required_structure = {
    5: [  # –î–µ–Ω–µ–∂–Ω—ã–µ –∞–≥—Ä–µ–≥–∞—Ç—ã (—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–µ–Ω–µ–∂–Ω–æ–π –º–∞—Å—Å—ã)
        5,  # –î–µ–Ω–µ–∂–Ω—ã–π –∞–≥—Ä–µ–≥–∞—Ç –ú0
        6,  # –î–µ–Ω–µ–∂–Ω—ã–π –∞–≥—Ä–µ–≥–∞—Ç –ú1
        7,  # –î–µ–Ω–µ–∂–Ω—ã–π –∞–≥—Ä–µ–≥–∞—Ç –ú2
        8,  # –®–∏—Ä–æ–∫–∞—è –¥–µ–Ω–µ–∂–Ω–∞—è –º–∞—Å—Å–∞
    ],
    8: [  # –ü–ª–∞—Ç–µ–∂–Ω—ã–π –±–∞–ª–∞–Ω—Å ‚Äî —Å–≤–æ–¥–Ω—ã–µ —Å–∞–ª—å–¥–æ —Å—á–µ—Ç–æ–≤
        9,  # –°–∞–ª—å–¥–æ —Å—á–µ—Ç–∞ —Ç–µ–∫—É—â–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
        10, # –°–∞–ª—å–¥–æ —Å—á–µ—Ç–∞ –æ–ø–µ—Ä–∞—Ü–∏–π —Å –∫–∞–ø–∏—Ç–∞–ª–æ–º
        11, # –°–∞–ª—å–¥–æ —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–≥–æ —Å—á–µ—Ç–∞
        12, # –ß–∏—Å—Ç—ã–µ –æ—à–∏–±–∫–∏ –∏ –ø—Ä–æ–ø—É—Å–∫–∏
    ],
    9: [  # –ü–ª–∞—Ç–µ–∂–Ω—ã–π –±–∞–ª–∞–Ω—Å ‚Äî –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å—á–µ—Ç–∞ —Ç–µ–∫—É—â–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
        13, # –¢–æ–≤–∞—Ä—ã
        14, # –£—Å–ª—É–≥–∏
        15, # –ü–µ—Ä–≤–∏—á–Ω—ã–µ –¥–æ—Ö–æ–¥—ã
        16, # –í—Ç–æ—Ä–∏—á–Ω—ã–µ –¥–æ—Ö–æ–¥—ã
    ],
    10: [  # –°—á–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–π —Å –∫–∞–ø–∏—Ç–∞–ª–æ–º
        17, # –ü—Ä–∏–æ–±—Ä–µ—Ç–µ–Ω–∏–µ/–≤—ã–±—ã—Ç–∏–µ –Ω–µ–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–Ω—ã—Ö –Ω–µ—Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –∞–∫—Ç–∏–≤–æ–≤
        18, # –ö–∞–ø–∏—Ç–∞–ª—å–Ω—ã–µ —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä—Ç—ã
    ],
    11: [  # –§–∏–Ω–∞–Ω—Å–æ–≤—ã–π —Å—á–µ—Ç ‚Äî —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–π
        19, # –ü—Ä—è–º—ã–µ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏
        20, # –ü–æ—Ä—Ç—Ñ–µ–ª—å–Ω—ã–µ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏
        21, # –ü—Ä–æ–∏–∑–≤–æ–¥–Ω—ã–µ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –∏ –æ–ø—Ü–∏–æ–Ω—ã
        22, # –ü—Ä–æ—á–∏–µ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏
        23, # –†–µ–∑–µ—Ä–≤–Ω—ã–µ –∞–∫—Ç–∏–≤—ã
    ],
    12: [  # –ë–∞–ª–∞–Ω—Å–∏—Ä—É—é—â–∞—è —Å—Ç–∞—Ç—å—è –ø–ª–∞—Ç–µ–∂–Ω–æ–≥–æ –±–∞–ª–∞–Ω—Å–∞
        24, # –ß–∏—Å—Ç—ã–µ –æ—à–∏–±–∫–∏ –∏ –ø—Ä–æ–ø—É—Å–∫–∏
    ],
    14: [  # –°—Ä–µ–¥–Ω–∏–µ —Å—Ç–∞–≤–∫–∏ –ø–æ –∫—Ä–µ–¥–∏—Ç–∞–º (–≤—Å–µ–≥–æ, –±–µ–∑ –≤–∞–ª—é—Ç–Ω–æ–≥–æ –¥–µ–ª–µ–Ω–∏—è)
        25, # –°—Ç–∞–≤–∫–∏ –ø–æ –∫—Ä–µ–¥–∏—Ç–∞–º –Ω–µ—Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–º –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è–º
        26, # –°—Ç–∞–≤–∫–∏ –ø–æ –∫—Ä–µ–¥–∏—Ç–∞–º –Ω–µ—Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–º –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è–º ‚Äî —Å—É–±—ä–µ–∫—Ç–∞–º –ú–°–ü
        27, # –°—Ç–∞–≤–∫–∏ –ø–æ –∫—Ä–µ–¥–∏—Ç–∞–º —Ñ–∏–∑–∏—á–µ—Å–∫–∏–º –ª–∏—Ü–∞–º
        28, # –°—Ç–∞–≤–∫–∏ –ø–æ –∞–≤—Ç–æ–∫—Ä–µ–¥–∏—Ç–∞–º
        29, # –°—Ç–∞–≤–∫–∏ –ø–æ –∏–ø–æ—Ç–µ—á–Ω—ã–º –∂–∏–ª–∏—â–Ω—ã–º –∫—Ä–µ–¥–∏—Ç–∞–º
    ],
    15: [  # –°—Ç–∞–≤–∫–∏ –ø–æ –∫—Ä–µ–¥–∏—Ç–∞–º –≤ —Ä—É–±–ª—è—Ö
        30, # –°—Ç–∞–≤–∫–∏ –ø–æ –∫—Ä–µ–¥–∏—Ç–∞–º –Ω–µ—Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–º –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è–º –≤ —Ä—É–±–ª—è—Ö
        31, # –°—Ç–∞–≤–∫–∏ –ø–æ –∫—Ä–µ–¥–∏—Ç–∞–º –Ω–µ—Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–º –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è–º ‚Äî —Å—É–±—ä–µ–∫—Ç–∞–º –ú–°–ü –≤ —Ä—É–±–ª—è—Ö
        32, # –°—Ç–∞–≤–∫–∏ –ø–æ –∫—Ä–µ–¥–∏—Ç–∞–º —Ñ–∏–∑–∏—á–µ—Å–∫–∏–º –ª–∏—Ü–∞–º –≤ —Ä—É–±–ª—è—Ö
        33, # –°—Ç–∞–≤–∫–∏ –ø–æ –∞–≤—Ç–æ–∫—Ä–µ–¥–∏—Ç–∞–º –≤ —Ä—É–±–ª—è—Ö
        34, # –°—Ç–∞–≤–∫–∏ –ø–æ –∏–ø–æ—Ç–µ—á–Ω—ã–º –∂–∏–ª–∏—â–Ω—ã–º –∫—Ä–µ–¥–∏—Ç–∞–º
    ],
    16: [  # –°—Ç–∞–≤–∫–∏ –ø–æ –∫—Ä–µ–¥–∏—Ç–∞–º –Ω–µ—Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–º –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è–º (—É–∫–æ—Ä–æ—á–µ–Ω–Ω—ã–π –Ω–∞–±–æ—Ä)
        35, # –°—Ç–∞–≤–∫–∏ –ø–æ –∫—Ä–µ–¥–∏—Ç–∞–º –Ω–µ—Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–º –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è–º
        36, # –°—Ç–∞–≤–∫–∏ –ø–æ –∫—Ä–µ–¥–∏—Ç–∞–º –Ω–µ—Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–º –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è–º ‚Äî —Å—É–±—ä–µ–∫—Ç–∞–º –ú–°–ü
    ],
    18: [  # –°—Ç–∞–≤–∫–∏ –ø–æ –¥–µ–ø–æ–∑–∏—Ç–∞–º (–≤–∫–ª–∞–¥—ã —Ñ–∏–∑–∏—á–µ—Å–∫–∏—Ö –∏ —é—Ä–∏–¥–∏—á–µ—Å–∫–∏—Ö –ª–∏—Ü)
        37, # –°—Ç–∞–≤–∫–∏ –ø–æ –≤–∫–ª–∞–¥–∞–º —Ñ–∏–∑–∏—á–µ—Å–∫–∏—Ö –ª–∏—Ü
        38, # –°—Ç–∞–≤–∫–∏ –ø–æ –≤–∫–ª–∞–¥–∞–º –Ω–µ—Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π
    ],
    19: [  # –°—Ç–∞–≤–∫–∏ –ø–æ –¥–µ–ø–æ–∑–∏—Ç–∞–º –≤ —Ä—É–±–ª—è—Ö
        39, # –°—Ç–∞–≤–∫–∏ –ø–æ –≤–∫–ª–∞–¥–∞–º —Ñ–∏–∑–∏—á–µ—Å–∫–∏—Ö –ª–∏—Ü –≤ —Ä—É–±–ª—è—Ö
        40, # –°—Ç–∞–≤–∫–∏ –ø–æ –≤–∫–ª–∞–¥–∞–º –Ω–µ—Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π –≤ —Ä—É–±–ª—è—Ö
    ],
    20: [  # –û–±—ä–µ–º—ã –∏ –∑–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç—å –ø–æ –∫—Ä–µ–¥–∏—Ç–∞–º (–∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ)
        41, # –û–±—ä–µ–º –∫—Ä–µ–¥–∏—Ç–æ–≤
        42, # –ó–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç—å –ø–æ –∫—Ä–µ–¥–∏—Ç–∞–º
        43, # –ü—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω–∞—è –∑–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç—å –ø–æ –∫—Ä–µ–¥–∏—Ç–∞–º
    ],
    21: [  # –ö—Ä–µ–¥–∏—Ç–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å ‚Äî –¥–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏
        44, # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫—Ä–µ–¥–∏—Ç–æ–≤
        45, # –û–±—ä–µ–º –∫—Ä–µ–¥–∏—Ç–æ–≤
        46, # –ó–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç—å –ø–æ –∫—Ä–µ–¥–∏—Ç–∞–º
        55, # –°–µ–∑–æ–Ω–Ω–æ —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∑–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç—å –ø–æ –∫—Ä–µ–¥–∏—Ç–∞–º
        56, # –°–µ–∑–æ–Ω–Ω–æ —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∑–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç—å —Å —É—á–µ—Ç–æ–º –ø—Ä–∞–≤ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
        47, # –ü—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω–∞—è –∑–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç—å –ø–æ –∫—Ä–µ–¥–∏—Ç–∞–º
        48, # –°—Ä–µ–¥–Ω–µ–≤–∑–≤–µ—à–µ–Ω–Ω—ã–π —Å—Ä–æ–∫ –ø–æ –∫—Ä–µ–¥–∏—Ç–∞–º
    ],
    22: [  # –ö—Ä–µ–¥–∏—Ç–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å ‚Äî –Ω–µ—Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
        49, # –û–±—ä–µ–º –∫—Ä–µ–¥–∏—Ç–æ–≤
        50, # –ó–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç—å –ø–æ –∫—Ä–µ–¥–∏—Ç–∞–º
        51, # –ü—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω–∞—è –∑–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç—å –ø–æ –∫—Ä–µ–¥–∏—Ç–∞–º
    ],
    23: [  # –ö—Ä–µ–¥–∏—Ç–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å ‚Äî —Ñ–∏–∑–∏—á–µ—Å–∫–∏–µ –ª–∏—Ü–∞
        52, # –û–±—ä–µ–º –∫—Ä–µ–¥–∏—Ç–æ–≤
        53, # –ó–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç—å –ø–æ –∫—Ä–µ–¥–∏—Ç–∞–º
        54, # –ü—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω–∞—è –∑–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç—å –ø–æ –∫—Ä–µ–¥–∏—Ç–∞–º
    ],
    25: [  # –î–∏—Ñ—Ñ—É–∑–Ω—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –ø–æ —Å–µ–∫—Ç–æ—Ä–∞–º –∏ –æ–∂–∏–¥–∞–Ω–∏—è–º (–æ–ø—Ä–æ—Å –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–π)
        58,  # –≠–∫–æ–Ω–æ–º–∏–∫–∞ –≤—Å–µ–≥–æ
        59,  # –ü—Ä–æ–º—ã—à–ª–µ–Ω–Ω–æ—Å—Ç—å
        60,  # –î–æ–±—ã—á–∞
        61,  # –û–±—Ä–∞–±–æ—Ç–∫–∞
        62,  # –û–±—Ä–∞–±–æ—Ç–∫–∞ (–ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å—Å–∫–∏–µ —Ç–æ–≤–∞—Ä—ã)
        63,  # –û–±—Ä–∞–±–æ—Ç–∫–∞ (–∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã)
        64,  # –û–±—Ä–∞–±–æ—Ç–∫–∞ (–ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã)
        65,  # –≠–≠–ì–ü
        66,  # –í–æ–¥–æ—Å–Ω–∞–±–∂–µ–Ω–∏–µ
        67,  # –°–µ–ª—å—Å–∫–æ–µ —Ö–æ–∑—è–π—Å—Ç–≤–æ
        68,  # –°—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ
        69,  # –¢–æ—Ä–≥–æ–≤–ª—è –≤—Å–µ–≥–æ
        70,  # –ê–≤—Ç–æ—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç
        71,  # –û–ø—Ç–æ–≤–∞—è —Ç–æ—Ä–≥–æ–≤–ª—è
        72,  # –†–æ–∑–Ω–∏—á–Ω–∞—è —Ç–æ—Ä–≥–æ–≤–ª—è
        73,  # –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –∏ —Ö—Ä–∞–Ω–µ–Ω–∏–µ
        74,  # –£—Å–ª—É–≥–∏
        75,  # –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω—ã—Ö –º–æ—â–Ω–æ—Å—Ç–µ–π
        76,  # –ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
        77,  # –û–∂–∏–¥–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
        78,  # –û–±–µ—Å–ø–µ—á–µ–Ω–Ω–æ—Å—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª–æ–º
        79,  # –û–∂–∏–¥–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —á–∏—Å–ª–µ–Ω–Ω–æ—Å—Ç–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª–∞
        140, # –û–∂–∏–¥–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞—Å—Ö–æ–¥–æ–≤ –Ω–∞ –æ–ø–ª–∞—Ç—É —Ç—Ä—É–¥–∞
    ],
    26: [  # –£—á–∞—Å—Ç–Ω–∏–∫–∏ –æ–ø—Ä–æ—Å–∞ –ë–∞–Ω–∫–∞ –†–æ—Å—Å–∏–∏
        57,  # –ß–∏—Å–ª–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –æ–ø—Ä–æ—Å–∞
    ],
    28: [  # –î–∏—Ñ—Ñ—É–∑–Ω—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –ø–æ —Å–µ–∫—Ç–æ—Ä–∞–º ‚Äî –ø–∞–Ω–µ–ª—å 1
        80,  # –≠–∫–æ–Ω–æ–º–∏–∫–∞ –≤—Å–µ–≥–æ
        83,  # –ü—Ä–æ–º—ã—à–ª–µ–Ω–Ω–æ—Å—Ç—å
        86,  # –î–æ–±—ã—á–∞
        89,  # –û–±—Ä–∞–±–æ—Ç–∫–∞
        92,  # –°–µ–ª—å—Å–∫–æ–µ —Ö–æ–∑—è–π—Å—Ç–≤–æ
        95,  # –°—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ
        98,  # –¢–æ—Ä–≥–æ–≤–ª—è –≤—Å–µ–≥–æ
        101, # –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –∏ —Ö—Ä–∞–Ω–µ–Ω–∏–µ
        104, # –£—Å–ª—É–≥–∏
        107, # –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω—ã—Ö –º–æ—â–Ω–æ—Å—Ç–µ–π
        110, # –ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
        113, # –û–∂–∏–¥–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
        116, # –û–±–µ—Å–ø–µ—á–µ–Ω–Ω–æ—Å—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª–æ–º
        119, # –û–∂–∏–¥–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —á–∏—Å–ª–µ–Ω–Ω–æ—Å—Ç–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª–∞
    ],
    29: [  # –î–∏—Ñ—Ñ—É–∑–Ω—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –ø–æ —Å–µ–∫—Ç–æ—Ä–∞–º ‚Äî –ø–∞–Ω–µ–ª—å 2
        81,  # –≠–∫–æ–Ω–æ–º–∏–∫–∞ –≤—Å–µ–≥–æ
        84,  # –ü—Ä–æ–º—ã—à–ª–µ–Ω–Ω–æ—Å—Ç—å
        87,  # –î–æ–±—ã—á–∞
        90,  # –û–±—Ä–∞–±–æ—Ç–∫–∞
        93,  # –°–µ–ª—å—Å–∫–æ–µ —Ö–æ–∑—è–π—Å—Ç–≤–æ
        96,  # –°—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ
        99,  # –¢–æ—Ä–≥–æ–≤–ª—è –≤—Å–µ–≥–æ
        102, # –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –∏ —Ö—Ä–∞–Ω–µ–Ω–∏–µ
        105, # –£—Å–ª—É–≥–∏
        108, # –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω—ã—Ö –º–æ—â–Ω–æ—Å—Ç–µ–π
        111, # –ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
        114, # –û–∂–∏–¥–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
        117, # –û–±–µ—Å–ø–µ—á–µ–Ω–Ω–æ—Å—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª–æ–º
        120, # –û–∂–∏–¥–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —á–∏—Å–ª–µ–Ω–Ω–æ—Å—Ç–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª–∞
    ],
    30: [  # –î–∏—Ñ—Ñ—É–∑–Ω—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –ø–æ —Å–µ–∫—Ç–æ—Ä–∞–º ‚Äî –ø–∞–Ω–µ–ª—å 3
        82,  # –≠–∫–æ–Ω–æ–º–∏–∫–∞ –≤—Å–µ–≥–æ
        85,  # –ü—Ä–æ–º—ã—à–ª–µ–Ω–Ω–æ—Å—Ç—å
        88,  # –î–æ–±—ã—á–∞
        91,  # –û–±—Ä–∞–±–æ—Ç–∫–∞
        94,  # –°–µ–ª—å—Å–∫–æ–µ —Ö–æ–∑—è–π—Å—Ç–≤–æ
        97,  # –°—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ
        100, # –¢–æ—Ä–≥–æ–≤–ª—è –≤—Å–µ–≥–æ
        103, # –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –∏ —Ö—Ä–∞–Ω–µ–Ω–∏–µ
        106, # –£—Å–ª—É–≥–∏
        109, # –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω—ã—Ö –º–æ—â–Ω–æ—Å—Ç–µ–π
        112, # –ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
        115, # –û–∂–∏–¥–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
        118, # –û–±–µ—Å–ø–µ—á–µ–Ω–Ω–æ—Å—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª–æ–º
        121, # –û–∂–∏–¥–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —á–∏—Å–ª–µ–Ω–Ω–æ—Å—Ç–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª–∞
    ],
    33: [  # –ö—É—Ä—Å—ã –≤–∞–ª—é—Ç ‚Äî —É—Ä–æ–≤–Ω–∏ (type=2)
        127, # –ù–æ–º–∏–Ω–∞–ª—å–Ω—ã–π –∫—É—Ä—Å
        128, # –°—Ä–µ–¥–Ω–∏–π –Ω–æ–º–∏–Ω–∞–ª—å–Ω—ã–π –∫—É—Ä—Å –∑–∞ –ø–µ—Ä–∏–æ–¥
        139, # –°—Ä–µ–¥–Ω–∏–π –Ω–æ–º–∏–Ω–∞–ª—å–Ω—ã–π –∫—É—Ä—Å –∑–∞ –ø–µ—Ä–∏–æ–¥ —Å –Ω–∞—á–∞–ª–∞ –≥–æ–¥–∞
    ],
    34: [  # –ò–Ω–¥–µ–∫—Å—ã –≤–∞–ª—é—Ç–Ω–æ–≥–æ –∫—É—Ä—Å–∞ ‚Äî –Ω–æ–º–∏–Ω–∞–ª—å–Ω—ã–π/—Ä–µ–∞–ª—å–Ω—ã–π, —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ (type=1)
        129, # –ò–Ω–¥–µ–∫—Å –Ω–æ–º–∏–Ω–∞–ª—å–Ω–æ–≥–æ –∫—É—Ä—Å–∞
        130, # –ò–Ω–¥–µ–∫—Å –Ω–æ–º–∏–Ω–∞–ª—å–Ω–æ–≥–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–≥–æ –∫—É—Ä—Å–∞ —Ä—É–±–ª—è
        131, # –ò–Ω–¥–µ–∫—Å —Ä–µ–∞–ª—å–Ω–æ–≥–æ –∫—É—Ä—Å–∞
        132, # –ò–Ω–¥–µ–∫—Å —Ä–µ–∞–ª—å–Ω–æ–≥–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–≥–æ –∫—É—Ä—Å–∞ —Ä—É–±–ª—è
    ],
    35: [  # –ö—É—Ä—Å—ã –≤–∞–ª—é—Ç ‚Äî —É—Ä–æ–≤–Ω–∏ (type=2)
        133, # –ù–æ–º–∏–Ω–∞–ª—å–Ω—ã–π –∫—É—Ä—Å
        134, # –°—Ä–µ–¥–Ω–∏–π –Ω–æ–º–∏–Ω–∞–ª—å–Ω—ã–π –∫—É—Ä—Å –∑–∞ –ø–µ—Ä–∏–æ–¥
        141, # –°—Ä–µ–¥–Ω–∏–π –Ω–æ–º–∏–Ω–∞–ª—å–Ω—ã–π –∫—É—Ä—Å –∑–∞ –ø–µ—Ä–∏–æ–¥ —Å –Ω–∞—á–∞–ª–∞ –≥–æ–¥–∞
    ],
    36: [  # –ò–Ω–¥–µ–∫—Å—ã –≤–∞–ª—é—Ç–Ω–æ–≥–æ –∫—É—Ä—Å–∞ ‚Äî –Ω–æ–º–∏–Ω–∞–ª—å–Ω—ã–π/—Ä–µ–∞–ª—å–Ω—ã–π, —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ (type=1)
        135, # –ò–Ω–¥–µ–∫—Å –Ω–æ–º–∏–Ω–∞–ª—å–Ω–æ–≥–æ –∫—É—Ä—Å–∞
        136, # –ò–Ω–¥–µ–∫—Å –Ω–æ–º–∏–Ω–∞–ª—å–Ω–æ–≥–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–≥–æ –∫—É—Ä—Å–∞ —Ä—É–±–ª—è
        137, # –ò–Ω–¥–µ–∫—Å —Ä–µ–∞–ª—å–Ω–æ–≥–æ –∫—É—Ä—Å–∞
        138, # –ò–Ω–¥–µ–∫—Å —Ä–µ–∞–ª—å–Ω–æ–≥–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–≥–æ –∫—É—Ä—Å–∞ —Ä—É–±–ª—è
    ],
}



# –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏, –Ω–æ —Ñ–∏–ª—å—Ç—Ä—É–µ–º –Ω—É–∂–Ω—ã–µ
all_publications = get_publications()
publications = [p for p in all_publications if p["id"] in required_structure]

print(f"üîç –í—ã–≥—Ä—É–∂–∞–µ–º —Ç–æ–ª—å–∫–æ {len(publications)} –∑–∞–¥–∞–Ω–Ω—ã—Ö –ø—É–±–ª–∏–∫–∞—Ü–∏–π")

dataset_map = {
    "–°—Ç–∞–≤–∫–∏ –ø–æ –∫—Ä–µ–¥–∏—Ç–∞–º –Ω–µ—Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–º –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è–º": "–°—Ç–∞–ö—Ä–µ–¥–ù–µ–§–∏–Ω",
    "–°—Ç–∞–≤–∫–∏ –ø–æ –∫—Ä–µ–¥–∏—Ç–∞–º –Ω–µ—Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–º –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è–º-—Å—É–±—ä–µ–∫—Ç–∞–º –ú–°–ü": "–°—Ç–∞–ö—Ä–µ–¥–ú–°–ü",
    "–°—Ç–∞–≤–∫–∏ –ø–æ –∫—Ä–µ–¥–∏—Ç–∞–º —Ñ–∏–∑–∏—á–µ—Å–∫–∏–º –ª–∏—Ü–∞–º": "–°—Ç–∞–ö—Ä–µ–¥–§–õ",
    "–°—Ç–∞–≤–∫–∏ –ø–æ –∞–≤—Ç–æ–∫—Ä–µ–¥–∏—Ç–∞–º": "–°—Ç–∞–ö—Ä–µ–¥–ê–≤—Ç–æ",
    "–°—Ç–∞–≤–∫–∏ –ø–æ –∏–ø–æ—Ç–µ—á–Ω—ã–º –∂–∏–ª–∏—â–Ω—ã–º –∫—Ä–µ–¥–∏—Ç–∞–º": "–°—Ç–∞–ò–ø–æ—Ç",
    "–°—Ç–∞–≤–∫–∏ –ø–æ –≤–∫–ª–∞–¥–∞–º (–¥–µ–ø–æ–∑–∏—Ç–∞–º) —Ñ–∏–∑–∏—á–µ—Å–∫–∏—Ö –ª–∏—Ü":"–°—Ç–∞–í–∫–ª–§–õ",
    "–°—Ç–∞–≤–∫–∏ –ø–æ –≤–∫–ª–∞–¥–∞–º (–¥–µ–ø–æ–∑–∏—Ç–∞–º) –Ω–µ—Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π":"–°—Ç–∞–í–∫–ª–Æ–õ",
    "–û–±—ä–µ–º –∫—Ä–µ–¥–∏—Ç–æ–≤": "–û–±—ä–ö—Ä–µ–¥",
    "–°—Ç–∞–≤–∫–∏ –ø–æ –≤–∫–ª–∞–¥–∞–º (–¥–µ–ø–æ–∑–∏—Ç–∞–º) —Ñ–∏–∑–∏—á–µ—Å–∫–∏—Ö –ª–∏—Ü –≤ —Ä—É–±–ª—è—Ö": "–°—Ç–∞–í–∫–ª–§–õ–†—É–±",
    "–°—Ç–∞–≤–∫–∏ –ø–æ –≤–∫–ª–∞–¥–∞–º (–¥–µ–ø–æ–∑–∏—Ç–∞–º) –Ω–µ—Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π –≤ —Ä—É–±–ª—è—Ö":"–°—Ç–∞–í–∫–ª–ù–µ–§–∏–Ω–†—É–±",
    "–ó–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç—å –ø–æ –∫—Ä–µ–¥–∏—Ç–∞–º": "–î–æ–ª–≥–ö—Ä–µ–¥",
    "–ü—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω–∞—è –∑–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç—å –ø–æ –∫—Ä–µ–¥–∏—Ç–∞–º": "–ü—Ä–æ—Å—Ä–æ—á–∫–∞",
    "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫—Ä–µ–¥–∏—Ç–æ–≤": "–ö–æ–ª–≤–æ–ö—Ä–µ–¥",
    "–°–µ–∑–æ–Ω–Ω–æ —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∑–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç—å –ø–æ –∫—Ä–µ–¥–∏—Ç–∞–º": "–°–µ–∑–æ–Ω–ö—Ä–µ–¥",
    "–°–µ–∑–æ–Ω–Ω–æ —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∑–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç—å –ø–æ –∫—Ä–µ–¥–∏—Ç–∞–º —Å —É—á–µ—Ç–æ–º –ø—Ä–∏–æ–±—Ä–µ—Ç–µ–Ω–Ω—ã—Ö –∫—Ä–µ–¥–∏—Ç–Ω—ã–º–∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è–º–∏ –ø—Ä–∞–≤ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è": "–°–µ–∑–æ–Ω–ö—Ä–µ–¥–¢—Ä–µ–±",
    "–°—Ä–µ–¥–Ω–µ–≤–∑–≤–µ—à–µ–Ω–Ω—ã–π —Å—Ä–æ–∫ –ø–æ –∫—Ä–µ–¥–∏—Ç–∞–º": "–í–∑–≤–°—Ä–æ–∫–ö—Ä–µ–¥",
    "–î–µ–Ω–µ–∂–Ω—ã–π –∞–≥—Ä–µ–≥–∞—Ç –ú0": "–ú0",
    "–î–µ–Ω–µ–∂–Ω—ã–π –∞–≥—Ä–µ–≥–∞—Ç –ú1": "–ú1",
    "–î–µ–Ω–µ–∂–Ω—ã–π –∞–≥—Ä–µ–≥–∞—Ç –ú2": "–ú2",
    "–®–∏—Ä–æ–∫–∞—è –¥–µ–Ω–µ–∂–Ω–∞—è –º–∞—Å—Å–∞": "–ú–∞—Å—Å–∞",
    "–°–∞–ª—å–¥–æ —Å—á–µ—Ç–∞ —Ç–µ–∫—É—â–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π": "–°–¢–û",
    "–°–∞–ª—å–¥–æ —Å—á–µ—Ç–∞ –æ–ø–µ—Ä–∞—Ü–∏–π —Å –∫–∞–ø–∏—Ç–∞–ª–æ–º": "–°–û–ö",
    "–°–∞–ª—å–¥–æ —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–≥–æ —Å—á–µ—Ç–∞": "–°–§–°",
    "–ß–∏—Å—Ç—ã–µ –æ—à–∏–±–∫–∏ –∏ –ø—Ä–æ–ø—É—Å–∫–∏": "–ß–û–ü",
    "–¢–æ–≤–∞—Ä—ã": "–¢–æ–≤–∞—Ä—ã",
    "–£—Å–ª—É–≥–∏": "–£—Å–ª—É–≥–∏",
    "–ü–µ—Ä–≤–∏—á–Ω—ã–µ –¥–æ—Ö–æ–¥—ã": "–ü–µ—Ä–≤–î–æ—Ö",
    "–í—Ç–æ—Ä–∏—á–Ω—ã–µ –¥–æ—Ö–æ–¥—ã": "–í—Ç–æ—Ä–î–æ—Ö",
    "–ü—Ä–∏–æ–±—Ä–µ—Ç–µ–Ω–∏–µ/–≤—ã–±—ã—Ç–∏–µ –Ω–µ–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–Ω—ã—Ö –Ω–µ—Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –∞–∫—Ç–∏–≤–æ–≤": "–ù–µ—Ñ–∏–Ω–ê–∫—Ç",
    "–ö–∞–ø–∏—Ç–∞–ª—å–Ω—ã–µ —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä—Ç—ã": "–ö–∞–ø–¢—Ä–∞–Ω—Å",
    "–ü—Ä—è–º—ã–µ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏": "–ü—Ä—è–º—ã–µ–ò–Ω",
    "–ü–æ—Ä—Ç—Ñ–µ–ª—å–Ω—ã–µ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏": "–ü–æ—Ä—Ç—Ñ–ò–Ω",
    "–ü—Ä–æ–∏–∑–≤–æ–¥–Ω—ã–µ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã (–∫—Ä–æ–º–µ —Ä–µ–∑–µ—Ä–≤–æ–≤) –∏ –æ–ø—Ü–∏–æ–Ω—ã –Ω–∞ –∞–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç–Ω–∏–∫–æ–≤": "–û–ø—Ü–∏–æ–Ω—ã",
    "–ü—Ä–æ—á–∏–µ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏": "–ü—Ä–æ—á–ò–Ω",
    "–†–µ–∑–µ—Ä–≤–Ω—ã–µ –∞–∫—Ç–∏–≤—ã": "–†–µ–∑–µ—Ä–≤",
    "–ù–æ–º–∏–Ω–∞–ª—å–Ω—ã–π –∫—É—Ä—Å": "–ù–ö",
    "–°—Ä–µ–¥–Ω–∏–π –Ω–æ–º–∏–Ω–∞–ª—å–Ω—ã–π –∫—É—Ä—Å –∑–∞ –ø–µ—Ä–∏–æ–¥": "–°—Ä–ù–ö",
    "–°—Ä–µ–¥–Ω–∏–π –Ω–æ–º–∏–Ω–∞–ª—å–Ω—ã–π –∫—É—Ä—Å –∑–∞ –ø–µ—Ä–∏–æ–¥ —Å –Ω–∞—á–∞–ª–∞ –≥–æ–¥–∞": "–°—Ä–ù–ö_YtD",
    "–ò–Ω–¥–µ–∫—Å –Ω–æ–º–∏–Ω–∞–ª—å–Ω–æ–≥–æ –∫—É—Ä—Å–∞": "–ò–Ω–ù–ö",
    "–ò–Ω–¥–µ–∫—Å –Ω–æ–º–∏–Ω–∞–ª—å–Ω–æ–≥–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–≥–æ –∫—É—Ä—Å–∞ —Ä—É–±–ª—è –∫ –∏–Ω–æ—Å—Ç—Ä–∞–Ω–Ω—ã–º –≤–∞–ª—é—Ç–∞–º": "–ò–Ω–ù–≠—Ñ–ö–†—É–±–∫–ò–Ω",
    "–ò–Ω–¥–µ–∫—Å —Ä–µ–∞–ª—å–Ω–æ–≥–æ –∫—É—Ä—Å–∞": "–ò–Ω–†–ö",
    "–ò–Ω–¥–µ–∫—Å —Ä–µ–∞–ª—å–Ω–æ–≥–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–≥–æ –∫—É—Ä—Å–∞ —Ä—É–±–ª—è –∫ –∏–Ω–æ—Å—Ç—Ä–∞–Ω–Ω—ã–º –≤–∞–ª—é—Ç–∞–º": "–ò–Ω–†–≠—Ñ–ö–†—É–±–ò–Ω",
    "–≠–∫–æ–Ω–æ–º–∏–∫–∞ –≤—Å–µ–≥–æ": "–≠–∫_–≤—Å–µ–≥–æ",
    "–ü—Ä–æ–º—ã—à–ª–µ–Ω–Ω–æ—Å—Ç—å": "–ü—Ä–æ–º",
    "–î–æ–±—ã—á–∞": "–î–æ–±",
    "–û–±—Ä–∞–±–æ—Ç–∫–∞": "–û–±—Ä",
    "–û–±—Ä–∞–±–æ—Ç–∫–∞ (–ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å—Å–∫–∏–µ —Ç–æ–≤–∞—Ä—ã)": "–û–±—Ä_–ø–æ—Ç—Ä–µ–±",
    "–û–±—Ä–∞–±–æ—Ç–∫–∞ (–∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã)": "–û–±—Ä_–∏–Ω–≤",
    "–û–±—Ä–∞–±–æ—Ç–∫–∞ (–ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã)": "–û–±—Ä_–ø—Ä–æ–º–µ–∂",
    "–≠–≠–ì–ü": "–≠–≠–ì–ü",
    "–í–æ–¥–æ—Å–Ω–∞–±–∂–µ–Ω–∏–µ":"–í–æ–¥",
    "–°–µ–ª—å—Å–∫–æ–µ —Ö–æ–∑—è–π—Å—Ç–≤–æ": "–°–•",
    "–°—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ": "–°—Ç—Ä–æ–π",
    "–¢–æ—Ä–≥–æ–≤–ª—è –≤—Å–µ–≥–æ": "–¢–æ—Ä–≥_–≤—Å–µ–≥–æ",
    "–ê–≤—Ç–æ—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç": "–ê–≤—Ç–¢—Ä–∞–Ω",
    "–û–ø—Ç–æ–≤–∞—è": "–û–ø—Ç",
    "–†–æ–∑–Ω–∏—á–Ω–∞—è": "–†–æ–∑–Ω",
    "–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –∏ —Ö—Ä–∞–Ω–µ–Ω–∏–µ":"–¢—Ä–∞–Ω–•—Ä–∞–Ω",
    "–ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω—ã—Ö –º–æ—â–Ω–æ—Å—Ç–µ–π":"–ü—Ä–æ–∏–∑–≤–ú–æ—â",
    "–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å": "–ò–Ω–≤–ê–∫—Ç",
    "–û–∂–∏–¥–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏": "–û–∂–î–µ–ª–ò–Ω–≤–ê–∫—Ç",
    "–û–∂–∏–¥–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —á–∏—Å–ª–µ–Ω–Ω–æ—Å—Ç–∏": "–û–∂–î–µ–ª–ß–∏—Å–ª",
    "–û–∂–∏–¥–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞—Å—Ö–æ–¥–æ–≤ –Ω–∞ –æ–ø–ª–∞—Ç—É —Ç—Ä—É–¥–∞": "–û–∂–î–µ–ª–ó–ü",
    "–ß–∏—Å–ª–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –æ–ø—Ä–æ—Å–∞ –ë–∞–Ω–∫–∞ –†–æ—Å—Å–∏–∏": "–ß–£–û–ø—Ä–¶–ë"

}

def load_data_to_hadoop() -> None:
    dictionary_records: List[Dict[str, object]] = []
    dictionary_seen: Set[Tuple[str, str]] = set()
    metadata_rows: List[Dict[str, object]] = []
    created_tables: Set[str] = set()
    documented_tables: Set[str] = set()
    used_table_names: Set[str] = set()

    conn: Optional[pyodbc.Connection] = None
    cursor: Optional[pyodbc.Cursor] = None

    pub_map = {
        "–í —Ü–µ–ª–æ–º –ø–æ –†–æ—Å—Å–∏–π—Å–∫–æ–π –§–µ–¥–µ—Ä–∞—Ü–∏–∏": "–†—É—Å",
        "–í —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∞–ª—å–Ω–æ–º —Ä–∞–∑—Ä–µ–∑–µ": "–†–∞–∑",
        "–í —Ä–∞–∑—Ä–µ–∑–µ –ø–æ –≤–∏–¥–∞–º —ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–æ–π –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏": "–û—Ç—Ä",
        "–ü–æ –∫—Ä–µ–¥–∏—Ç–∞–º —Ñ–∏–∑–∏—á–µ—Å–∫–∏–º –ª–∏—Ü–∞–º": "–ö—Ä–µ–¥–§–õ",
        "–ü–æ –∏–ø–æ—Ç–µ—á–Ω—ã–º –∂–∏–ª–∏—â–Ω—ã–º –∫—Ä–µ–¥–∏—Ç–∞–º": "–ò–ø–æ—Ç",
        "–ü–æ –∫—Ä–µ–¥–∏—Ç–∞–º —é—Ä–∏–¥–∏—á–µ—Å–∫–∏–º –ª–∏—Ü–∞–º –∏ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–º –ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª—è–º (–≤ —Ç.—á. –ú–°–ü)": "–ö—Ä–µ–¥–Æ–õ–∏–ò–ü",
        "–ü–æ –∫—Ä–µ–¥–∏—Ç–∞–º —Å—É–±—ä–µ–∫—Ç–∞–º –ú–°–ü": "–ö—Ä–µ–¥–ú–°–ü",
        "–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–µ–Ω–µ–∂–Ω–æ–π –º–∞—Å—Å—ã": "–î–µ–Ω–ú–∞—Å",
        "–ö–ª—é—á–µ–≤—ã–µ –∞–≥—Ä–µ–≥–∞—Ç—ã": "–ö–ª–ê–≥—Ä",
        "–°—á–µ—Ç —Ç–µ–∫—É—â–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π": "–°–¢–û",
        "–°—á–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–π —Å –∫–∞–ø–∏—Ç–∞–ª–æ–º": "–°–û–ö",
        "–§–∏–Ω–∞–Ω—Å–æ–≤—ã–π —Å—á–µ—Ç": "–§–°",
        "–ß–∏—Å—Ç—ã–µ –æ—à–∏–±–∫–∏ –∏ –ø—Ä–æ–ø—É—Å–∫–∏": "–ß–û–ü",
        "–ù–æ–º–∏–Ω–∞–ª—å–Ω—ã–µ –∫—É—Ä—Å—ã –∏–Ω–æ—Å—Ç—Ä–∞–Ω–Ω—ã—Ö –≤–∞–ª—é—Ç –∫ —Ä—É–±–ª—é (—Ä—É–±–ª–µ–π –∑–∞ –µ–¥–∏–Ω–∏—Ü—É –∏–Ω–æ—Å—Ç—Ä–∞–Ω–Ω–æ–π –≤–∞–ª—é—Ç—ã) (–µ–∂–µ–º–µ—Å—è—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)": "–ù–ö–ò–∫–†_–º–µ—Å",
        "–ò–Ω–¥–µ–∫—Å—ã –æ–±–º–µ–Ω–Ω–æ–≥–æ –∫—É—Ä—Å–∞ —Ä—É–±–ª—è (–µ–∂–µ–º–µ—Å—è—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)": "–ò–Ω–û–ö–†—É–±_–º–µ—Å",
        "–ù–æ–º–∏–Ω–∞–ª—å–Ω—ã–µ –∫—É—Ä—Å—ã –∏–Ω–æ—Å—Ç—Ä–∞–Ω–Ω—ã—Ö –≤–∞–ª—é—Ç –∫ —Ä—É–±–ª—é (—Ä—É–±–ª–µ–π –∑–∞ –µ–¥–∏–Ω–∏—Ü—É –∏–Ω–æ—Å—Ç—Ä–∞–Ω–Ω–æ–π –≤–∞–ª—é—Ç—ã) (–µ–∂–µ–∫–≤–∞—Ä—Ç–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)": "–ù–ö–ò–∫–†_–µ–∂–∫",
        "–ò–Ω–¥–µ–∫—Å—ã –æ–±–º–µ–Ω–Ω–æ–≥–æ –∫—É—Ä—Å–∞ —Ä—É–±–ª—è (–µ–∂–µ–∫–≤–∞—Ä—Ç–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)": "–ò–Ω–û–ö–†—É–±_–µ–∂–∫",
        "–î–∞–Ω–Ω—ã–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –≤—Å–µ–≥–æ": "–î–ú",
        "–£—á–∞—Å—Ç–Ω–∏–∫–∏ –æ–ø—Ä–æ—Å–∞": "–£—á–û–ø—Ä",
        "–ö—Ä—É–ø–Ω—ã–µ": "–ö—Ä—É–ø",
        "–°—Ä–µ–¥–Ω–∏–µ": "–°—Ä–µ–¥",
        "–ú–∞–ª—ã–µ –∏ –º–∏–∫—Ä–æ": "–ú–∞–ª–ú–∏–∫",
    }

    meas_map = {
        "–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã–π –æ–∫—Ä—É–≥": "–¶–µ–Ω—Ç—Ä–û–∫—Ä",
        "–°–µ–≤–µ—Ä–æ-–ó–∞–ø–∞–¥–Ω—ã–π —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã–π –æ–∫—Ä—É–≥": "–°–µ–≤–ó–∞–ø–û–∫—Ä",
        "–Æ–∂–Ω—ã–π —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã–π –æ–∫—Ä—É–≥": "–Æ–∂–Ω–û–∫—Ä—É–≥",
        "–°–µ–≤–µ—Ä–æ-–ö–∞–≤–∫–∞–∑—Å–∫–∏–π —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã–π –æ–∫—Ä—É–≥": "–°–µ–≤–ö–∞–≤–û–∫—Ä",
        "–ü—Ä–∏–≤–æ–ª–∂—Å–∫–∏–π —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã–π –æ–∫—Ä—É–≥": "–ü—Ä–∏–≤–û–∫—Ä",
        "–£—Ä–∞–ª—å—Å–∫–∏–π —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã–π –æ–∫—Ä—É–≥": "–£—Ä–∞–ª–û–∫—Ä",
        "–°–∏–±–∏—Ä—Å–∫–∏–π —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã–π –æ–∫—Ä—É–≥": "–°–∏–±–û–∫—Ä",
        "–î–∞–ª—å–Ω–µ–≤–æ—Å—Ç–æ—á–Ω—ã–π —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã–π –æ–∫—Ä—É–≥": "–î–í–û–∫—Ä",
        "–†–æ—Å—Å–∏–π—Å–∫–∞—è –§–µ–¥–µ—Ä–∞—Ü–∏—è": "–†–§",
        "–ü—Ä–æ—á–µ–µ": "–ü—Ä–æ—á",
        "–í —Ä—É–±–ª—è—Ö": "—Ä—É–±",
        "–í –¥–æ–ª–ª–∞—Ä–∞—Ö –°–®–ê": "–¥–æ–ª",
        "–í –µ–≤—Ä–æ": "–µ–≤—Ä",
        "A. –°–µ–ª—å—Å–∫–æ–µ, –ª–µ—Å–Ω–æ–µ —Ö–æ–∑—è–π—Å—Ç–≤–æ, –æ—Ö–æ—Ç–∞, —Ä—ã–±–æ–ª–æ–≤—Å—Ç–≤–æ –∏ —Ä—ã–±–æ–≤–æ–¥—Å—Ç–≤–æ": "A–°–µ–ª–ª",
        "B. –î–æ–±—ã—á–∞ –ø–æ–ª–µ–∑–Ω—ã—Ö –∏—Å–∫–æ–ø–∞–µ–º—ã—Ö": "–î–æ–±—ã—á",
        "C. –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—â–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞": "–û–±—Ä–∞–±",
        "D. –û–±–µ—Å–ø–µ—á–µ–Ω–∏–µ —ç–ª–µ–∫—Ç—Ä–∏—á–µ—Å–∫–æ–π —ç–Ω–µ—Ä–≥–∏–µ–π, –≥–∞–∑–æ–º –∏ –ø–∞—Ä–æ–º; –∫–æ–Ω–¥–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–æ–∑–¥—É—Ö–∞": "–≠–Ω–µ—Ä–≥",
        "E. –í–æ–¥–æ—Å–Ω–∞–±–∂–µ–Ω–∏–µ; –≤–æ–¥–æ–æ—Ç–≤–µ–¥–µ–Ω–∏–µ, –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è —Å–±–æ—Ä–∞ –∏ —É—Ç–∏–ª–∏–∑–∞—Ü–∏–∏ –æ—Ç—Ö–æ–¥–æ–≤, –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–æ –ª–∏–∫–≤–∏–¥–∞—Ü–∏–∏ –∑–∞–≥—Ä—è–∑–Ω–µ–Ω–∏–π": "–í–æ–¥–≤",
        "F. –°—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ": "–°—Ç—Ä–æ–π",
        "G. –¢–æ—Ä–≥–æ–≤–ª—è –æ–ø—Ç–æ–≤–∞—è –∏ —Ä–æ–∑–Ω–∏—á–Ω–∞—è; —Ä–µ–º–æ–Ω—Ç –∞–≤—Ç–æ—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ã—Ö —Å—Ä–µ–¥—Å—Ç–≤ –∏ –º–æ—Ç–æ—Ü–∏–∫–ª–æ–≤": "–¢–æ—Ä–≥",
        "H. –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –∏ —Ö—Ä–∞–Ω–µ–Ω–∏–µ": "–¢—Ä–∞–Ω",
        "I. –î–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≥–æ—Å—Ç–∏–Ω–∏—Ü –∏ –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–π –æ–±—â–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –ø–∏—Ç–∞–Ω–∏—è": "–ì–æ—Ç",
        "J. –î–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤ –æ–±–ª–∞—Å—Ç–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∏ —Å–≤—è–∑–∏": "–ò–Ω—Ñ",
        "L. –î–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–æ –æ–ø–µ—Ä–∞—Ü–∏—è–º —Å –Ω–µ–¥–≤–∏–∂–∏–º—ã–º –∏–º—É—â–µ—Å—Ç–≤–æ–º": "–ù–µ–¥–≤",
        "M. –î–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è, –Ω–∞—É—á–Ω–∞—è –∏ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è": "–ü—Ä–æ—Ñ",
        "P. –û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ": "–û–±—Ä",
        "R. –î–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤ –æ–±–ª–∞—Å—Ç–∏ –∫—É–ª—å—Ç—É—Ä—ã, —Å–ø–æ—Ä—Ç–∞, –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –¥–æ—Å—É–≥–∞ –∏ —Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏–π": "–ö—É–ª—å—Ç",
        "–í —Ü–µ–ª–æ–º –ø–æ –†–æ—Å—Å–∏–π—Å–∫–æ–π –§–µ–¥–µ—Ä–∞—Ü–∏–∏": "–†—É—Å",
        "–í % –ø—Ä–∏—Ä–æ—Å—Ç–∞ –∫ –¥–µ–∫–∞–±—Ä—é –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –≥–æ–¥–∞": "%–¥–µ–∫-Y",
        "–í % –ø—Ä–∏—Ä–æ—Å—Ç–∞ –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É –ø–µ—Ä–∏–æ–¥—É": "%-–ü–µ—Ä",
        "–í % –ø—Ä–∏—Ä–æ—Å—Ç–∞ –∫ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–º—É –ø–µ—Ä–∏–æ–¥—É –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –≥–æ–¥–∞": "%-–≥–≥",
        "–ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ": "–ò—Å—Ö",
        "–°–µ–∑–æ–Ω–Ω–æ —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ": "–°–µ–∑–°–∫–æ—Ä",
        "–≠–∫–æ–Ω–æ–º–∏–∫–∞": "–≠–∫–æ–Ω",
        "–ü—Ä–æ–º—ã—à–ª–µ–Ω–Ω–æ–µ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ": "–ü—Ä–æ–º",
        "–î–æ–±—ã—á–∞ –ø–æ–ª–µ–∑–Ω—ã—Ö –∏—Å–∫–æ–ø–∞–µ–º—ã—Ö": "–î–æ–±—ã—á",
        "–û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—â–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞": "–û–±—Ä–∞–±",
        "–°–µ–ª—å—Å–∫–æ–µ, –ª–µ—Å–Ω–æ–µ —Ö–æ–∑—è–π—Å—Ç–≤–æ, –æ—Ö–æ—Ç–∞, —Ä—ã–±–æ–ª–æ–≤—Å—Ç–≤–æ –∏ —Ä—ã–±–æ–≤–æ–¥—Å—Ç–≤–æ": "–°–•",
        "–°—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ": "–°—Ç—Ä–æ–π",
        "–¢–æ—Ä–≥–æ–≤–ª—è –æ–ø—Ç–æ–≤–∞—è –∏ —Ä–æ–∑–Ω–∏—á–Ω–∞—è, —Ä–µ–º–æ–Ω—Ç –∞–≤—Ç–æ—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ã—Ö —Å—Ä–µ–¥—Å—Ç–≤ –∏ –º–æ—Ç–æ—Ü–∏–∫–ª–æ–≤": "–¢–æ—Ä–≥",
        "–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –∏ —Ö—Ä–∞–Ω–µ–Ω–∏–µ": "–¢—Ä–∞–Ω–•—Ä–∞–Ω",
        "–£—Å–ª—É–≥–∏": "–£—Å–ª—É–≥–∏",
    }

    try:
        print(f"[{datetime.now()}] –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Impala —á–µ—Ä–µ–∑ DSN='{HADOOP_DSN}'...")
        conn = connect_impala()
        cursor = conn.cursor()
        ensure_database(cursor, HADOOP_DATABASE)
        print(f"[{datetime.now()}] –ü–æ–¥–∫–ª—é—á–µ–Ω–æ. –¶–µ–ª–µ–≤–∞—è –±–∞–∑–∞: {HADOOP_DATABASE}")

        for pub in publications:
            pub_id = pub["id"]
            pub_name = pub["category_name"]
            print(f"\nüìò –ü—É–±–ª–∏–∫–∞—Ü–∏—è ID={pub_id}: {pub_name}")

            try:
                datasets = get_datasets(pub_id)
            except Exception as error:
                print(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π: {error}")
                continue

            for dataset in datasets:
                if dataset["id"] not in required_structure[pub_id]:
                    continue

                dataset_id = dataset["id"]
                dataset_name = dataset["name"] or f"dataset_{dataset_id}"
                dataset_type = dataset.get("type", 0)

                print(f"üì°  ‚Üí –ü–æ–∫–∞–∑–∞—Ç–µ–ª—å ID={dataset_id}: {dataset_name} (type={dataset_type})")

                measure_ids: List[Optional[int]] = []
                measure_map: Dict[Optional[int], str] = {}
                if dataset_type == 1:
                    try:
                        measures = get_measures(dataset_id)
                        measure_ids = [m["id"] for m in measures if m["id"] is not None]
                        measure_map = {m["id"]: m["name"] for m in measures if m["id"] is not None}
                        if not measure_ids:
                            print("‚ö† –ù–µ—Ç —Ä–∞–∑—Ä–µ–∑–æ–≤, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º")
                            continue
                    except Exception as error:
                        print(f"‚ö† –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å measure –¥–ª—è dataset {dataset_id}: {error}")
                        continue
                else:
                    measure_ids = [None]

                if dataset_id in [30, 31, 32, 33]:
                    measure_ids = [23, 42, 55, 64, 72, 87, 95, 106]
                elif dataset_id in [34, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54]:
                    measure_ids = [22]

                for measure_id in measure_ids:
                    meas_abbr_raw = "" if measure_id is None else measure_map.get(measure_id, "")
                    meas_abbr = meas_map.get(meas_abbr_raw, meas_abbr_raw)
                    meas_short = meas_abbr if meas_abbr else ""

                    pub_short = pub_map.get(pub_name, abbr(pub_name))
                    dataset_short = dataset_map.get(dataset_name, abbr(dataset_name))

                    name_parts = [pub_short, dataset_short]
                    if meas_short:
                        name_parts.append(meas_short)

                    name_parts_trimmed = [part[:12] for part in name_parts]
                    table_alias_ru = "_".join(name_parts_trimmed)
                    table_alias_en = normalize_identifier(table_alias_ru, COLUMN_IDENTIFIER_MAX_LENGTH)

                    try:
                        data_json = get_data(YEAR_FROM, YEAR_TO, dataset_id, pub_id, measure_id)
                        raw = data_json.get("RawData", [])
                        headers = data_json.get("headerData", [])
                        units = data_json.get("units", [])
                        df = pd.DataFrame(raw)

                        if df.empty:
                            print(f"‚ö† –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö (measureId={measure_id})")
                            continue

                        element_map = {h["id"]: h.get("elname", "") for h in headers}
                        unit_map = {u["id"]: u.get("val", "") for u in units}

                        df["indicator_name"] = headers[0]["elname"] if headers else dataset_name
                        if "element_id" in df.columns:
                            df["element_name"] = df["element_id"].map(element_map)
                        if "measure_id" in df.columns and measure_map:
                            df["measure_name"] = df["measure_id"].map(measure_map)
                        if "unit_id" in df.columns:
                            df["unit_name"] = df["unit_id"].map(unit_map)

                        df["publication_id"] = pub_id
                        df["publication_name"] = pub_name
                        df["dataset_id"] = dataset_id
                        df["dataset_name"] = dataset_name
                        df["measure_id_requested"] = measure_id
                        df["table_alias"] = table_alias_en

                        if "obs_val" in df.columns:
                            df = df[[col for col in df.columns if col != "obs_val"] + ["obs_val"]]

                        df = df.convert_dtypes()

                        context_info = {
                            "publication_id": pub_id,
                            "publication_name": pub_name,
                            "dataset_id": dataset_id,
                            "dataset_name": dataset_name,
                            "measure_id": measure_id,
                            "measure_name": meas_abbr_raw or "",
                        }

                        english_table_name = build_table_name(
                            dataset_name=dataset_name,
                            measure_label=meas_abbr_raw,
                            dataset_id=dataset_id,
                            measure_id=measure_id,
                            used_names=used_table_names,
                        )

                        if english_table_name not in documented_tables:
                            russian_caption_parts = [pub_name, dataset_name]
                            if meas_abbr_raw:
                                russian_caption_parts.append(meas_abbr_raw)
                            russian_caption = " | ".join(russian_caption_parts)
                            dictionary_records.append(
                                {
                                    **context_info,
                                    "entity_type": "table",
                                    "table_name": english_table_name,
                                    "column_name": "",
                                    "english_name": english_table_name,
                                    "russian_name": russian_caption,
                                }
                            )
                            documented_tables.add(english_table_name)

                        df = rename_columns_with_translation(
                            df,
                            english_table_name,
                            dictionary_records,
                            context_info,
                            dictionary_seen,
                        )

                        if english_table_name not in created_tables:
                            create_impala_table(cursor, HADOOP_DATABASE, english_table_name, df)
                            created_tables.add(english_table_name)

                        insert_dataframe(cursor, HADOOP_DATABASE, english_table_name, df)

                        metadata_rows.append(
                            {
                                "table_name": english_table_name,
                                "table_alias_en": table_alias_en,
                                "table_alias_ru": table_alias_ru,
                                "publication_id": pub_id,
                                "publication_name": pub_name,
                                "dataset_id": dataset_id,
                                "dataset_name": dataset_name,
                                "measure_id": measure_id,
                                "measure_name": meas_abbr_raw or "",
                            }
                        )

                        print(f"‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ –≤ {HADOOP_DATABASE}.{english_table_name}: {len(df)} —Å—Ç—Ä–æ–∫")

                    except Exception as error:
                        print(
                            f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ dataset={dataset_id}, measureId={measure_id}: {error}"
                        )
                        continue

        if metadata_rows and cursor is not None:
            metadata_df = pd.DataFrame(metadata_rows).convert_dtypes()
            metadata_context = {
                "publication_id": None,
                "publication_name": "metadata",
                "dataset_id": None,
                "dataset_name": "metadata",
                "measure_id": None,
                "measure_name": "metadata",
            }

            if METADATA_TABLE_NAME not in documented_tables:
                dictionary_records.append(
                    {
                        **metadata_context,
                        "entity_type": "table",
                        "table_name": METADATA_TABLE_NAME,
                        "column_name": "",
                        "english_name": METADATA_TABLE_NAME,
                        "russian_name": "Metadata for loaded tables",
                    }
                )
                documented_tables.add(METADATA_TABLE_NAME)

            metadata_df = rename_columns_with_translation(
                metadata_df,
                METADATA_TABLE_NAME,
                dictionary_records,
                metadata_context,
                dictionary_seen,
            )

            create_impala_table(cursor, HADOOP_DATABASE, METADATA_TABLE_NAME, metadata_df)
            insert_dataframe(cursor, HADOOP_DATABASE, METADATA_TABLE_NAME, metadata_df)
            print(f"‚Ñπ –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω—ã –≤ {HADOOP_DATABASE}.{METADATA_TABLE_NAME}")

        if dictionary_records:
            dictionary_df = pd.DataFrame(dictionary_records)
            dictionary_df.to_csv(DICTIONARY_PATH, index=False, encoding="utf-8")
            print(f"‚Ñπ –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ —Å–æ—Ö—Ä–∞–Ω–µ–Ω: {DICTIONARY_PATH}")

        print("\nüìÅ –ì–æ—Ç–æ–≤–æ! –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –≤ Hadoop (Impala)")

    except Exception as error:
        print(f"[{datetime.now()}] –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: {error}")
        raise
    finally:
        if cursor is not None:
            cursor.close()
        if conn is not None:
            conn.close()
        print(f"[{datetime.now()}] –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–æ")


if __name__ == "__main__":
    load_data_to_hadoop()
