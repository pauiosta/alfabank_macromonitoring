import requests
import pandas as pd
import re
from pathlib import Path
BASE_URL = "https://cbr.ru/dataservice"
YEAR_FROM = 2010
YEAR_TO = 2025


def get_publications():
    url = f"{BASE_URL}/publications"
    response = requests.get(url)
    response.raise_for_status()
    return [p for p in response.json() if p.get("NoActive") != 1]  # –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤—ã–≤–∞–µ–º –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–µ

def get_datasets(publication_id):
    url = f"{BASE_URL}/datasets"
    response = requests.get(url, params={"publicationId": publication_id})
    response.raise_for_status()
    return response.json()

def get_measures(dataset_id):
    url = f"{BASE_URL}/measures"
    response = requests.get(url, params={"datasetId": dataset_id})
    response.raise_for_status()
    return response.json().get("measure", [])

def get_data(y1, y2, dataset_id, publication_id, measure_id=None):
    url = f"{BASE_URL}/data"
    params = {
        "y1": y1,
        "y2": y2,
        "datasetId": dataset_id,
        "publicationId": publication_id
    }
    if measure_id is not None:
        params["measureId"] = measure_id
    response = requests.get(url, params=params)
    response.raise_for_status()
    return response.json()

def abbr(text):
    return ''.join([w[:3] for w in re.findall(r'\w+', text)])[:15]

# –¢–û–õ–¨–ö–û –Ω—É–∂–Ω—ã–µ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –∏ –∏—Ö –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏
required_structure = {
    5: [  # –î–µ–Ω–µ–∂–Ω—ã–µ –∞–≥—Ä–µ–≥–∞—Ç—ã (—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–µ–Ω–µ–∂–Ω–æ–π –º–∞—Å—Å—ã)
        5,  # –î–µ–Ω–µ–∂–Ω—ã–π –∞–≥—Ä–µ–≥–∞—Ç –ú0
        6,  # –î–µ–Ω–µ–∂–Ω—ã–π –∞–≥—Ä–µ–≥–∞—Ç –ú1
        7,  # –î–µ–Ω–µ–∂–Ω—ã–π –∞–≥—Ä–µ–≥–∞—Ç –ú2
        8,  # –®–∏—Ä–æ–∫–∞—è –¥–µ–Ω–µ–∂–Ω–∞—è –º–∞—Å—Å–∞
    ],
    8: [  # –ü–ª–∞—Ç–µ–∂–Ω—ã–π –±–∞–ª–∞–Ω—Å ‚Äî —Å–≤–æ–¥–Ω—ã–µ —Å–∞–ª—å–¥–æ —Å—á–µ—Ç–æ–≤
        9,  # –°–∞–ª—å–¥–æ —Å—á–µ—Ç–∞ —Ç–µ–∫—É—â–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
        10, # –°–∞–ª—å–¥–æ —Å—á–µ—Ç–∞ –æ–ø–µ—Ä–∞—Ü–∏–π —Å –∫–∞–ø–∏—Ç–∞–ª–æ–º
        11, # –°–∞–ª—å–¥–æ —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–≥–æ —Å—á–µ—Ç–∞
        12, # –ß–∏—Å—Ç—ã–µ –æ—à–∏–±–∫–∏ –∏ –ø—Ä–æ–ø—É—Å–∫–∏
    ],
    9: [  # –ü–ª–∞—Ç–µ–∂–Ω—ã–π –±–∞–ª–∞–Ω—Å ‚Äî –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å—á–µ—Ç–∞ —Ç–µ–∫—É—â–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
        13, # –¢–æ–≤–∞—Ä—ã
        14, # –£—Å–ª—É–≥–∏
        15, # –ü–µ—Ä–≤–∏—á–Ω—ã–µ –¥–æ—Ö–æ–¥—ã
        16, # –í—Ç–æ—Ä–∏—á–Ω—ã–µ –¥–æ—Ö–æ–¥—ã
    ],
    10: [  # –°—á–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–π —Å –∫–∞–ø–∏—Ç–∞–ª–æ–º
        17, # –ü—Ä–∏–æ–±—Ä–µ—Ç–µ–Ω–∏–µ/–≤—ã–±—ã—Ç–∏–µ –Ω–µ–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–Ω—ã—Ö –Ω–µ—Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –∞–∫—Ç–∏–≤–æ–≤
        18, # –ö–∞–ø–∏—Ç–∞–ª—å–Ω—ã–µ —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä—Ç—ã
    ],
    11: [  # –§–∏–Ω–∞–Ω—Å–æ–≤—ã–π —Å—á–µ—Ç ‚Äî —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–π
        19, # –ü—Ä—è–º—ã–µ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏
        20, # –ü–æ—Ä—Ç—Ñ–µ–ª—å–Ω—ã–µ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏
        21, # –ü—Ä–æ–∏–∑–≤–æ–¥–Ω—ã–µ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –∏ –æ–ø—Ü–∏–æ–Ω—ã
        22, # –ü—Ä–æ—á–∏–µ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏
        23, # –†–µ–∑–µ—Ä–≤–Ω—ã–µ –∞–∫—Ç–∏–≤—ã
    ],
    12: [  # –ë–∞–ª–∞–Ω—Å–∏—Ä—É—é—â–∞—è —Å—Ç–∞—Ç—å—è –ø–ª–∞—Ç–µ–∂–Ω–æ–≥–æ –±–∞–ª–∞–Ω—Å–∞
        24, # –ß–∏—Å—Ç—ã–µ –æ—à–∏–±–∫–∏ –∏ –ø—Ä–æ–ø—É—Å–∫–∏
    ],
    14: [  # –°—Ä–µ–¥–Ω–∏–µ —Å—Ç–∞–≤–∫–∏ –ø–æ –∫—Ä–µ–¥–∏—Ç–∞–º (–≤—Å–µ–≥–æ, –±–µ–∑ –≤–∞–ª—é—Ç–Ω–æ–≥–æ –¥–µ–ª–µ–Ω–∏—è)
        25, # –°—Ç–∞–≤–∫–∏ –ø–æ –∫—Ä–µ–¥–∏—Ç–∞–º –Ω–µ—Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–º –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è–º
        26, # –°—Ç–∞–≤–∫–∏ –ø–æ –∫—Ä–µ–¥–∏—Ç–∞–º –Ω–µ—Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–º –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è–º ‚Äî —Å—É–±—ä–µ–∫—Ç–∞–º –ú–°–ü
        27, # –°—Ç–∞–≤–∫–∏ –ø–æ –∫—Ä–µ–¥–∏—Ç–∞–º —Ñ–∏–∑–∏—á–µ—Å–∫–∏–º –ª–∏—Ü–∞–º
        28, # –°—Ç–∞–≤–∫–∏ –ø–æ –∞–≤—Ç–æ–∫—Ä–µ–¥–∏—Ç–∞–º
        29, # –°—Ç–∞–≤–∫–∏ –ø–æ –∏–ø–æ—Ç–µ—á–Ω—ã–º –∂–∏–ª–∏—â–Ω—ã–º –∫—Ä–µ–¥–∏—Ç–∞–º
    ],
    15: [  # –°—Ç–∞–≤–∫–∏ –ø–æ –∫—Ä–µ–¥–∏—Ç–∞–º –≤ —Ä—É–±–ª—è—Ö
        30, # –°—Ç–∞–≤–∫–∏ –ø–æ –∫—Ä–µ–¥–∏—Ç–∞–º –Ω–µ—Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–º –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è–º –≤ —Ä—É–±–ª—è—Ö
        31, # –°—Ç–∞–≤–∫–∏ –ø–æ –∫—Ä–µ–¥–∏—Ç–∞–º –Ω–µ—Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–º –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è–º ‚Äî —Å—É–±—ä–µ–∫—Ç–∞–º –ú–°–ü –≤ —Ä—É–±–ª—è—Ö
        32, # –°—Ç–∞–≤–∫–∏ –ø–æ –∫—Ä–µ–¥–∏—Ç–∞–º —Ñ–∏–∑–∏—á–µ—Å–∫–∏–º –ª–∏—Ü–∞–º –≤ —Ä—É–±–ª—è—Ö
        33, # –°—Ç–∞–≤–∫–∏ –ø–æ –∞–≤—Ç–æ–∫—Ä–µ–¥–∏—Ç–∞–º –≤ —Ä—É–±–ª—è—Ö
        34, # –°—Ç–∞–≤–∫–∏ –ø–æ –∏–ø–æ—Ç–µ—á–Ω—ã–º –∂–∏–ª–∏—â–Ω—ã–º –∫—Ä–µ–¥–∏—Ç–∞–º
    ],
    16: [  # –°—Ç–∞–≤–∫–∏ –ø–æ –∫—Ä–µ–¥–∏—Ç–∞–º –Ω–µ—Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–º –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è–º (—É–∫–æ—Ä–æ—á–µ–Ω–Ω—ã–π –Ω–∞–±–æ—Ä)
        35, # –°—Ç–∞–≤–∫–∏ –ø–æ –∫—Ä–µ–¥–∏—Ç–∞–º –Ω–µ—Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–º –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è–º
        36, # –°—Ç–∞–≤–∫–∏ –ø–æ –∫—Ä–µ–¥–∏—Ç–∞–º –Ω–µ—Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–º –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è–º ‚Äî —Å—É–±—ä–µ–∫—Ç–∞–º –ú–°–ü
    ],
    18: [  # –°—Ç–∞–≤–∫–∏ –ø–æ –¥–µ–ø–æ–∑–∏—Ç–∞–º (–≤–∫–ª–∞–¥—ã —Ñ–∏–∑–∏—á–µ—Å–∫–∏—Ö –∏ —é—Ä–∏–¥–∏—á–µ—Å–∫–∏—Ö –ª–∏—Ü)
        37, # –°—Ç–∞–≤–∫–∏ –ø–æ –≤–∫–ª–∞–¥–∞–º —Ñ–∏–∑–∏—á–µ—Å–∫–∏—Ö –ª–∏—Ü
        38, # –°—Ç–∞–≤–∫–∏ –ø–æ –≤–∫–ª–∞–¥–∞–º –Ω–µ—Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π
    ],
    19: [  # –°—Ç–∞–≤–∫–∏ –ø–æ –¥–µ–ø–æ–∑–∏—Ç–∞–º –≤ —Ä—É–±–ª—è—Ö
        39, # –°—Ç–∞–≤–∫–∏ –ø–æ –≤–∫–ª–∞–¥–∞–º —Ñ–∏–∑–∏—á–µ—Å–∫–∏—Ö –ª–∏—Ü –≤ —Ä—É–±–ª—è—Ö
        40, # –°—Ç–∞–≤–∫–∏ –ø–æ –≤–∫–ª–∞–¥–∞–º –Ω–µ—Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π –≤ —Ä—É–±–ª—è—Ö
    ],
    20: [  # –û–±—ä–µ–º—ã –∏ –∑–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç—å –ø–æ –∫—Ä–µ–¥–∏—Ç–∞–º (–∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ)
        41, # –û–±—ä–µ–º –∫—Ä–µ–¥–∏—Ç–æ–≤
        42, # –ó–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç—å –ø–æ –∫—Ä–µ–¥–∏—Ç–∞–º
        43, # –ü—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω–∞—è –∑–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç—å –ø–æ –∫—Ä–µ–¥–∏—Ç–∞–º
    ],
    21: [  # –ö—Ä–µ–¥–∏—Ç–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å ‚Äî –¥–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏
        44, # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫—Ä–µ–¥–∏—Ç–æ–≤
        45, # –û–±—ä–µ–º –∫—Ä–µ–¥–∏—Ç–æ–≤
        46, # –ó–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç—å –ø–æ –∫—Ä–µ–¥–∏—Ç–∞–º
        55, # –°–µ–∑–æ–Ω–Ω–æ —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∑–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç—å –ø–æ –∫—Ä–µ–¥–∏—Ç–∞–º
        56, # –°–µ–∑–æ–Ω–Ω–æ —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∑–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç—å —Å —É—á–µ—Ç–æ–º –ø—Ä–∞–≤ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
        47, # –ü—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω–∞—è –∑–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç—å –ø–æ –∫—Ä–µ–¥–∏—Ç–∞–º
        48, # –°—Ä–µ–¥–Ω–µ–≤–∑–≤–µ—à–µ–Ω–Ω—ã–π —Å—Ä–æ–∫ –ø–æ –∫—Ä–µ–¥–∏—Ç–∞–º
    ],
    22: [  # –ö—Ä–µ–¥–∏—Ç–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å ‚Äî –Ω–µ—Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
        49, # –û–±—ä–µ–º –∫—Ä–µ–¥–∏—Ç–æ–≤
        50, # –ó–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç—å –ø–æ –∫—Ä–µ–¥–∏—Ç–∞–º
        51, # –ü—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω–∞—è –∑–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç—å –ø–æ –∫—Ä–µ–¥–∏—Ç–∞–º
    ],
    23: [  # –ö—Ä–µ–¥–∏—Ç–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å ‚Äî —Ñ–∏–∑–∏—á–µ—Å–∫–∏–µ –ª–∏—Ü–∞
        52, # –û–±—ä–µ–º –∫—Ä–µ–¥–∏—Ç–æ–≤
        53, # –ó–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç—å –ø–æ –∫—Ä–µ–¥–∏—Ç–∞–º
        54, # –ü—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω–∞—è –∑–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç—å –ø–æ –∫—Ä–µ–¥–∏—Ç–∞–º
    ],
    25: [  # –î–∏—Ñ—Ñ—É–∑–Ω—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –ø–æ —Å–µ–∫—Ç–æ—Ä–∞–º –∏ –æ–∂–∏–¥–∞–Ω–∏—è–º (–æ–ø—Ä–æ—Å –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–π)
        58,  # –≠–∫–æ–Ω–æ–º–∏–∫–∞ –≤—Å–µ–≥–æ
        59,  # –ü—Ä–æ–º—ã—à–ª–µ–Ω–Ω–æ—Å—Ç—å
        60,  # –î–æ–±—ã—á–∞
        61,  # –û–±—Ä–∞–±–æ—Ç–∫–∞
        62,  # –û–±—Ä–∞–±–æ—Ç–∫–∞ (–ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å—Å–∫–∏–µ —Ç–æ–≤–∞—Ä—ã)
        63,  # –û–±—Ä–∞–±–æ—Ç–∫–∞ (–∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã)
        64,  # –û–±—Ä–∞–±–æ—Ç–∫–∞ (–ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã)
        65,  # –≠–≠–ì–ü
        66,  # –í–æ–¥–æ—Å–Ω–∞–±–∂–µ–Ω–∏–µ
        67,  # –°–µ–ª—å—Å–∫–æ–µ —Ö–æ–∑—è–π—Å—Ç–≤–æ
        68,  # –°—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ
        69,  # –¢–æ—Ä–≥–æ–≤–ª—è –≤—Å–µ–≥–æ
        70,  # –ê–≤—Ç–æ—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç
        71,  # –û–ø—Ç–æ–≤–∞—è —Ç–æ—Ä–≥–æ–≤–ª—è
        72,  # –†–æ–∑–Ω–∏—á–Ω–∞—è —Ç–æ—Ä–≥–æ–≤–ª—è
        73,  # –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –∏ —Ö—Ä–∞–Ω–µ–Ω–∏–µ
        74,  # –£—Å–ª—É–≥–∏
        75,  # –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω—ã—Ö –º–æ—â–Ω–æ—Å—Ç–µ–π
        76,  # –ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
        77,  # –û–∂–∏–¥–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
        78,  # –û–±–µ—Å–ø–µ—á–µ–Ω–Ω–æ—Å—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª–æ–º
        79,  # –û–∂–∏–¥–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —á–∏—Å–ª–µ–Ω–Ω–æ—Å—Ç–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª–∞
        140, # –û–∂–∏–¥–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞—Å—Ö–æ–¥–æ–≤ –Ω–∞ –æ–ø–ª–∞—Ç—É —Ç—Ä—É–¥–∞
    ],
    26: [  # –£—á–∞—Å—Ç–Ω–∏–∫–∏ –æ–ø—Ä–æ—Å–∞ –ë–∞–Ω–∫–∞ –†–æ—Å—Å–∏–∏
        57,  # –ß–∏—Å–ª–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –æ–ø—Ä–æ—Å–∞
    ],
    28: [  # –î–∏—Ñ—Ñ—É–∑–Ω—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –ø–æ —Å–µ–∫—Ç–æ—Ä–∞–º ‚Äî –ø–∞–Ω–µ–ª—å 1
        80,  # –≠–∫–æ–Ω–æ–º–∏–∫–∞ –≤—Å–µ–≥–æ
        83,  # –ü—Ä–æ–º—ã—à–ª–µ–Ω–Ω–æ—Å—Ç—å
        86,  # –î–æ–±—ã—á–∞
        89,  # –û–±—Ä–∞–±–æ—Ç–∫–∞
        92,  # –°–µ–ª—å—Å–∫–æ–µ —Ö–æ–∑—è–π—Å—Ç–≤–æ
        95,  # –°—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ
        98,  # –¢–æ—Ä–≥–æ–≤–ª—è –≤—Å–µ–≥–æ
        101, # –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –∏ —Ö—Ä–∞–Ω–µ–Ω–∏–µ
        104, # –£—Å–ª—É–≥–∏
        107, # –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω—ã—Ö –º–æ—â–Ω–æ—Å—Ç–µ–π
        110, # –ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
        113, # –û–∂–∏–¥–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
        116, # –û–±–µ—Å–ø–µ—á–µ–Ω–Ω–æ—Å—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª–æ–º
        119, # –û–∂–∏–¥–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —á–∏—Å–ª–µ–Ω–Ω–æ—Å—Ç–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª–∞
    ],
    29: [  # –î–∏—Ñ—Ñ—É–∑–Ω—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –ø–æ —Å–µ–∫—Ç–æ—Ä–∞–º ‚Äî –ø–∞–Ω–µ–ª—å 2
        81,  # –≠–∫–æ–Ω–æ–º–∏–∫–∞ –≤—Å–µ–≥–æ
        84,  # –ü—Ä–æ–º—ã—à–ª–µ–Ω–Ω–æ—Å—Ç—å
        87,  # –î–æ–±—ã—á–∞
        90,  # –û–±—Ä–∞–±–æ—Ç–∫–∞
        93,  # –°–µ–ª—å—Å–∫–æ–µ —Ö–æ–∑—è–π—Å—Ç–≤–æ
        96,  # –°—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ
        99,  # –¢–æ—Ä–≥–æ–≤–ª—è –≤—Å–µ–≥–æ
        102, # –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –∏ —Ö—Ä–∞–Ω–µ–Ω–∏–µ
        105, # –£—Å–ª—É–≥–∏
        108, # –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω—ã—Ö –º–æ—â–Ω–æ—Å—Ç–µ–π
        111, # –ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
        114, # –û–∂–∏–¥–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
        117, # –û–±–µ—Å–ø–µ—á–µ–Ω–Ω–æ—Å—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª–æ–º
        120, # –û–∂–∏–¥–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —á–∏—Å–ª–µ–Ω–Ω–æ—Å—Ç–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª–∞
    ],
    30: [  # –î–∏—Ñ—Ñ—É–∑–Ω—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –ø–æ —Å–µ–∫—Ç–æ—Ä–∞–º ‚Äî –ø–∞–Ω–µ–ª—å 3
        82,  # –≠–∫–æ–Ω–æ–º–∏–∫–∞ –≤—Å–µ–≥–æ
        85,  # –ü—Ä–æ–º—ã—à–ª–µ–Ω–Ω–æ—Å—Ç—å
        88,  # –î–æ–±—ã—á–∞
        91,  # –û–±—Ä–∞–±–æ—Ç–∫–∞
        94,  # –°–µ–ª—å—Å–∫–æ–µ —Ö–æ–∑—è–π—Å—Ç–≤–æ
        97,  # –°—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ
        100, # –¢–æ—Ä–≥–æ–≤–ª—è –≤—Å–µ–≥–æ
        103, # –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –∏ —Ö—Ä–∞–Ω–µ–Ω–∏–µ
        106, # –£—Å–ª—É–≥–∏
        109, # –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω—ã—Ö –º–æ—â–Ω–æ—Å—Ç–µ–π
        112, # –ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
        115, # –û–∂–∏–¥–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
        118, # –û–±–µ—Å–ø–µ—á–µ–Ω–Ω–æ—Å—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª–æ–º
        121, # –û–∂–∏–¥–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —á–∏—Å–ª–µ–Ω–Ω–æ—Å—Ç–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª–∞
    ],
    33: [  # –ö—É—Ä—Å—ã –≤–∞–ª—é—Ç ‚Äî —É—Ä–æ–≤–Ω–∏ (type=2)
        127, # –ù–æ–º–∏–Ω–∞–ª—å–Ω—ã–π –∫—É—Ä—Å
        128, # –°—Ä–µ–¥–Ω–∏–π –Ω–æ–º–∏–Ω–∞–ª—å–Ω—ã–π –∫—É—Ä—Å –∑–∞ –ø–µ—Ä–∏–æ–¥
        139, # –°—Ä–µ–¥–Ω–∏–π –Ω–æ–º–∏–Ω–∞–ª—å–Ω—ã–π –∫—É—Ä—Å –∑–∞ –ø–µ—Ä–∏–æ–¥ —Å –Ω–∞—á–∞–ª–∞ –≥–æ–¥–∞
    ],
    34: [  # –ò–Ω–¥–µ–∫—Å—ã –≤–∞–ª—é—Ç–Ω–æ–≥–æ –∫—É—Ä—Å–∞ ‚Äî –Ω–æ–º–∏–Ω–∞–ª—å–Ω—ã–π/—Ä–µ–∞–ª—å–Ω—ã–π, —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ (type=1)
        129, # –ò–Ω–¥–µ–∫—Å –Ω–æ–º–∏–Ω–∞–ª—å–Ω–æ–≥–æ –∫—É—Ä—Å–∞
        130, # –ò–Ω–¥–µ–∫—Å –Ω–æ–º–∏–Ω–∞–ª—å–Ω–æ–≥–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–≥–æ –∫—É—Ä—Å–∞ —Ä—É–±–ª—è
        131, # –ò–Ω–¥–µ–∫—Å —Ä–µ–∞–ª—å–Ω–æ–≥–æ –∫—É—Ä—Å–∞
        132, # –ò–Ω–¥–µ–∫—Å —Ä–µ–∞–ª—å–Ω–æ–≥–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–≥–æ –∫—É—Ä—Å–∞ —Ä—É–±–ª—è
    ],
    35: [  # –ö—É—Ä—Å—ã –≤–∞–ª—é—Ç ‚Äî —É—Ä–æ–≤–Ω–∏ (type=2)
        133, # –ù–æ–º–∏–Ω–∞–ª—å–Ω—ã–π –∫—É—Ä—Å
        134, # –°—Ä–µ–¥–Ω–∏–π –Ω–æ–º–∏–Ω–∞–ª—å–Ω—ã–π –∫—É—Ä—Å –∑–∞ –ø–µ—Ä–∏–æ–¥
        141, # –°—Ä–µ–¥–Ω–∏–π –Ω–æ–º–∏–Ω–∞–ª—å–Ω—ã–π –∫—É—Ä—Å –∑–∞ –ø–µ—Ä–∏–æ–¥ —Å –Ω–∞—á–∞–ª–∞ –≥–æ–¥–∞
    ],
    36: [  # –ò–Ω–¥–µ–∫—Å—ã –≤–∞–ª—é—Ç–Ω–æ–≥–æ –∫—É—Ä—Å–∞ ‚Äî –Ω–æ–º–∏–Ω–∞–ª—å–Ω—ã–π/—Ä–µ–∞–ª—å–Ω—ã–π, —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ (type=1)
        135, # –ò–Ω–¥–µ–∫—Å –Ω–æ–º–∏–Ω–∞–ª—å–Ω–æ–≥–æ –∫—É—Ä—Å–∞
        136, # –ò–Ω–¥–µ–∫—Å –Ω–æ–º–∏–Ω–∞–ª—å–Ω–æ–≥–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–≥–æ –∫—É—Ä—Å–∞ —Ä—É–±–ª—è
        137, # –ò–Ω–¥–µ–∫—Å —Ä–µ–∞–ª—å–Ω–æ–≥–æ –∫—É—Ä—Å–∞
        138, # –ò–Ω–¥–µ–∫—Å —Ä–µ–∞–ª—å–Ω–æ–≥–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–≥–æ –∫—É—Ä—Å–∞ —Ä—É–±–ª—è
    ],
}



# –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏, –Ω–æ —Ñ–∏–ª—å—Ç—Ä—É–µ–º –Ω—É–∂–Ω—ã–µ
all_publications = get_publications()
publications = [p for p in all_publications if p["id"] in required_structure]

print(f"üîç –í—ã–≥—Ä—É–∂–∞–µ–º —Ç–æ–ª—å–∫–æ {len(publications)} –∑–∞–¥–∞–Ω–Ω—ã—Ö –ø—É–±–ª–∏–∫–∞—Ü–∏–π")

dataset_map = {
    "–°—Ç–∞–≤–∫–∏ –ø–æ –∫—Ä–µ–¥–∏—Ç–∞–º –Ω–µ—Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–º –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è–º": "–°—Ç–∞–ö—Ä–µ–¥–ù–µ–§–∏–Ω",
    "–°—Ç–∞–≤–∫–∏ –ø–æ –∫—Ä–µ–¥–∏—Ç–∞–º –Ω–µ—Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–º –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è–º-—Å—É–±—ä–µ–∫—Ç–∞–º –ú–°–ü": "–°—Ç–∞–ö—Ä–µ–¥–ú–°–ü",
    "–°—Ç–∞–≤–∫–∏ –ø–æ –∫—Ä–µ–¥–∏—Ç–∞–º —Ñ–∏–∑–∏—á–µ—Å–∫–∏–º –ª–∏—Ü–∞–º": "–°—Ç–∞–ö—Ä–µ–¥–§–õ",
    "–°—Ç–∞–≤–∫–∏ –ø–æ –∞–≤—Ç–æ–∫—Ä–µ–¥–∏—Ç–∞–º": "–°—Ç–∞–ö—Ä–µ–¥–ê–≤—Ç–æ",
    "–°—Ç–∞–≤–∫–∏ –ø–æ –∏–ø–æ—Ç–µ—á–Ω—ã–º –∂–∏–ª–∏—â–Ω—ã–º –∫—Ä–µ–¥–∏—Ç–∞–º": "–°—Ç–∞–ò–ø–æ—Ç",
    "–°—Ç–∞–≤–∫–∏ –ø–æ –≤–∫–ª–∞–¥–∞–º (–¥–µ–ø–æ–∑–∏—Ç–∞–º) —Ñ–∏–∑–∏—á–µ—Å–∫–∏—Ö –ª–∏—Ü":"–°—Ç–∞–í–∫–ª–§–õ",
    "–°—Ç–∞–≤–∫–∏ –ø–æ –≤–∫–ª–∞–¥–∞–º (–¥–µ–ø–æ–∑–∏—Ç–∞–º) –Ω–µ—Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π":"–°—Ç–∞–í–∫–ª–Æ–õ",
    "–û–±—ä–µ–º –∫—Ä–µ–¥–∏—Ç–æ–≤": "–û–±—ä–ö—Ä–µ–¥",
    "–°—Ç–∞–≤–∫–∏ –ø–æ –≤–∫–ª–∞–¥–∞–º (–¥–µ–ø–æ–∑–∏—Ç–∞–º) —Ñ–∏–∑–∏—á–µ—Å–∫–∏—Ö –ª–∏—Ü –≤ —Ä—É–±–ª—è—Ö": "–°—Ç–∞–í–∫–ª–§–õ–†—É–±",
    "–°—Ç–∞–≤–∫–∏ –ø–æ –≤–∫–ª–∞–¥–∞–º (–¥–µ–ø–æ–∑–∏—Ç–∞–º) –Ω–µ—Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π –≤ —Ä—É–±–ª—è—Ö":"–°—Ç–∞–í–∫–ª–ù–µ–§–∏–Ω–†—É–±",
    "–ó–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç—å –ø–æ –∫—Ä–µ–¥–∏—Ç–∞–º": "–î–æ–ª–≥–ö—Ä–µ–¥",
    "–ü—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω–∞—è –∑–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç—å –ø–æ –∫—Ä–µ–¥–∏—Ç–∞–º": "–ü—Ä–æ—Å—Ä–æ—á–∫–∞",
    "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫—Ä–µ–¥–∏—Ç–æ–≤": "–ö–æ–ª–≤–æ–ö—Ä–µ–¥",
    "–°–µ–∑–æ–Ω–Ω–æ —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∑–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç—å –ø–æ –∫—Ä–µ–¥–∏—Ç–∞–º": "–°–µ–∑–æ–Ω–ö—Ä–µ–¥",
    "–°–µ–∑–æ–Ω–Ω–æ —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∑–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç—å –ø–æ –∫—Ä–µ–¥–∏—Ç–∞–º —Å —É—á–µ—Ç–æ–º –ø—Ä–∏–æ–±—Ä–µ—Ç–µ–Ω–Ω—ã—Ö –∫—Ä–µ–¥–∏—Ç–Ω—ã–º–∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è–º–∏ –ø—Ä–∞–≤ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è": "–°–µ–∑–æ–Ω–ö—Ä–µ–¥–¢—Ä–µ–±",
    "–°—Ä–µ–¥–Ω–µ–≤–∑–≤–µ—à–µ–Ω–Ω—ã–π —Å—Ä–æ–∫ –ø–æ –∫—Ä–µ–¥–∏—Ç–∞–º": "–í–∑–≤–°—Ä–æ–∫–ö—Ä–µ–¥",
    "–î–µ–Ω–µ–∂–Ω—ã–π –∞–≥—Ä–µ–≥–∞—Ç –ú0": "–ú0",
    "–î–µ–Ω–µ–∂–Ω—ã–π –∞–≥—Ä–µ–≥–∞—Ç –ú1": "–ú1",
    "–î–µ–Ω–µ–∂–Ω—ã–π –∞–≥—Ä–µ–≥–∞—Ç –ú2": "–ú2",
    "–®–∏—Ä–æ–∫–∞—è –¥–µ–Ω–µ–∂–Ω–∞—è –º–∞—Å—Å–∞": "–ú–∞—Å—Å–∞",
    "–°–∞–ª—å–¥–æ —Å—á–µ—Ç–∞ —Ç–µ–∫—É—â–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π": "–°–¢–û",
    "–°–∞–ª—å–¥–æ —Å—á–µ—Ç–∞ –æ–ø–µ—Ä–∞—Ü–∏–π —Å –∫–∞–ø–∏—Ç–∞–ª–æ–º": "–°–û–ö",
    "–°–∞–ª—å–¥–æ —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–≥–æ —Å—á–µ—Ç–∞": "–°–§–°",
    "–ß–∏—Å—Ç—ã–µ –æ—à–∏–±–∫–∏ –∏ –ø—Ä–æ–ø—É—Å–∫–∏": "–ß–û–ü",
    "–¢–æ–≤–∞—Ä—ã": "–¢–æ–≤–∞—Ä—ã",
    "–£—Å–ª—É–≥–∏": "–£—Å–ª—É–≥–∏",
    "–ü–µ—Ä–≤–∏—á–Ω—ã–µ –¥–æ—Ö–æ–¥—ã": "–ü–µ—Ä–≤–î–æ—Ö",
    "–í—Ç–æ—Ä–∏—á–Ω—ã–µ –¥–æ—Ö–æ–¥—ã": "–í—Ç–æ—Ä–î–æ—Ö",
    "–ü—Ä–∏–æ–±—Ä–µ—Ç–µ–Ω–∏–µ/–≤—ã–±—ã—Ç–∏–µ –Ω–µ–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–Ω—ã—Ö –Ω–µ—Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –∞–∫—Ç–∏–≤–æ–≤": "–ù–µ—Ñ–∏–Ω–ê–∫—Ç",
    "–ö–∞–ø–∏—Ç–∞–ª—å–Ω—ã–µ —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä—Ç—ã": "–ö–∞–ø–¢—Ä–∞–Ω—Å",
    "–ü—Ä—è–º—ã–µ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏": "–ü—Ä—è–º—ã–µ–ò–Ω",
    "–ü–æ—Ä—Ç—Ñ–µ–ª—å–Ω—ã–µ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏": "–ü–æ—Ä—Ç—Ñ–ò–Ω",
    "–ü—Ä–æ–∏–∑–≤–æ–¥–Ω—ã–µ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã (–∫—Ä–æ–º–µ —Ä–µ–∑–µ—Ä–≤–æ–≤) –∏ –æ–ø—Ü–∏–æ–Ω—ã –Ω–∞ –∞–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç–Ω–∏–∫–æ–≤": "–û–ø—Ü–∏–æ–Ω—ã",
    "–ü—Ä–æ—á–∏–µ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏": "–ü—Ä–æ—á–ò–Ω",
    "–†–µ–∑–µ—Ä–≤–Ω—ã–µ –∞–∫—Ç–∏–≤—ã": "–†–µ–∑–µ—Ä–≤",
    "–ù–æ–º–∏–Ω–∞–ª—å–Ω—ã–π –∫—É—Ä—Å": "–ù–ö",
    "–°—Ä–µ–¥–Ω–∏–π –Ω–æ–º–∏–Ω–∞–ª—å–Ω—ã–π –∫—É—Ä—Å –∑–∞ –ø–µ—Ä–∏–æ–¥": "–°—Ä–ù–ö",
    "–°—Ä–µ–¥–Ω–∏–π –Ω–æ–º–∏–Ω–∞–ª—å–Ω—ã–π –∫—É—Ä—Å –∑–∞ –ø–µ—Ä–∏–æ–¥ —Å –Ω–∞—á–∞–ª–∞ –≥–æ–¥–∞": "–°—Ä–ù–ö_YtD",
    "–ò–Ω–¥–µ–∫—Å –Ω–æ–º–∏–Ω–∞–ª—å–Ω–æ–≥–æ –∫—É—Ä—Å–∞": "–ò–Ω–ù–ö",
    "–ò–Ω–¥–µ–∫—Å –Ω–æ–º–∏–Ω–∞–ª—å–Ω–æ–≥–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–≥–æ –∫—É—Ä—Å–∞ —Ä—É–±–ª—è –∫ –∏–Ω–æ—Å—Ç—Ä–∞–Ω–Ω—ã–º –≤–∞–ª—é—Ç–∞–º": "–ò–Ω–ù–≠—Ñ–ö–†—É–±–∫–ò–Ω",
    "–ò–Ω–¥–µ–∫—Å —Ä–µ–∞–ª—å–Ω–æ–≥–æ –∫—É—Ä—Å–∞": "–ò–Ω–†–ö",
    "–ò–Ω–¥–µ–∫—Å —Ä–µ–∞–ª—å–Ω–æ–≥–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–≥–æ –∫—É—Ä—Å–∞ —Ä—É–±–ª—è –∫ –∏–Ω–æ—Å—Ç—Ä–∞–Ω–Ω—ã–º –≤–∞–ª—é—Ç–∞–º": "–ò–Ω–†–≠—Ñ–ö–†—É–±–ò–Ω",
    "–≠–∫–æ–Ω–æ–º–∏–∫–∞ –≤—Å–µ–≥–æ": "–≠–∫_–≤—Å–µ–≥–æ",
    "–ü—Ä–æ–º—ã—à–ª–µ–Ω–Ω–æ—Å—Ç—å": "–ü—Ä–æ–º",
    "–î–æ–±—ã—á–∞": "–î–æ–±",
    "–û–±—Ä–∞–±–æ—Ç–∫–∞": "–û–±—Ä",
    "–û–±—Ä–∞–±–æ—Ç–∫–∞ (–ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å—Å–∫–∏–µ —Ç–æ–≤–∞—Ä—ã)": "–û–±—Ä_–ø–æ—Ç—Ä–µ–±",
    "–û–±—Ä–∞–±–æ—Ç–∫–∞ (–∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã)": "–û–±—Ä_–∏–Ω–≤",
    "–û–±—Ä–∞–±–æ—Ç–∫–∞ (–ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã)": "–û–±—Ä_–ø—Ä–æ–º–µ–∂",
    "–≠–≠–ì–ü": "–≠–≠–ì–ü",
    "–í–æ–¥–æ—Å–Ω–∞–±–∂–µ–Ω–∏–µ":"–í–æ–¥",
    "–°–µ–ª—å—Å–∫–æ–µ —Ö–æ–∑—è–π—Å—Ç–≤–æ": "–°–•",
    "–°—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ": "–°—Ç—Ä–æ–π",
    "–¢–æ—Ä–≥–æ–≤–ª—è –≤—Å–µ–≥–æ": "–¢–æ—Ä–≥_–≤—Å–µ–≥–æ",
    "–ê–≤—Ç–æ—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç": "–ê–≤—Ç–¢—Ä–∞–Ω",
    "–û–ø—Ç–æ–≤–∞—è": "–û–ø—Ç",
    "–†–æ–∑–Ω–∏—á–Ω–∞—è": "–†–æ–∑–Ω",
    "–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –∏ —Ö—Ä–∞–Ω–µ–Ω–∏–µ":"–¢—Ä–∞–Ω–•—Ä–∞–Ω",
    "–ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω—ã—Ö –º–æ—â–Ω–æ—Å—Ç–µ–π":"–ü—Ä–æ–∏–∑–≤–ú–æ—â",
    "–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å": "–ò–Ω–≤–ê–∫—Ç",
    "–û–∂–∏–¥–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏": "–û–∂–î–µ–ª–ò–Ω–≤–ê–∫—Ç",
    "–û–∂–∏–¥–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —á–∏—Å–ª–µ–Ω–Ω–æ—Å—Ç–∏": "–û–∂–î–µ–ª–ß–∏—Å–ª",
    "–û–∂–∏–¥–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞—Å—Ö–æ–¥–æ–≤ –Ω–∞ –æ–ø–ª–∞—Ç—É —Ç—Ä—É–¥–∞": "–û–∂–î–µ–ª–ó–ü",
    "–ß–∏—Å–ª–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –æ–ø—Ä–æ—Å–∞ –ë–∞–Ω–∫–∞ –†–æ—Å—Å–∏–∏": "–ß–£–û–ø—Ä–¶–ë"

}

output_dir = Path("cbr_parquet")
output_dir.mkdir(parents=True, exist_ok=True)

for existing_file in output_dir.glob("*.parquet"):
    existing_file.unlink()

metadata_rows = []
saved_files = set()

for pub in publications:
    pub_id = pub["id"]
    pub_name = pub["category_name"]
    print(f"\nüìò –ü—É–±–ª–∏–∫–∞—Ü–∏—è ID={pub_id}: {pub_name}")

    try:
        datasets = get_datasets(pub_id)
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π: {e}")
        continue

    for dataset in datasets:
        if dataset["id"] not in required_structure[pub_id]:
            continue  # –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –ª–∏—à–Ω–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏

        dataset_id = dataset["id"]
        dataset_name = dataset["name"] or f"dataset_{dataset_id}"
        dataset_type = dataset.get("type", 0)

        print(f"üì°  ‚Üí –ü–æ–∫–∞–∑–∞—Ç–µ–ª—å ID={dataset_id}: {dataset_name} (type={dataset_type})")

        # measureId –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω —Ç–æ–ª—å–∫–æ –¥–ª—è type == 1
        measure_ids = []
        measure_map = {}
        if dataset_type == 1:
            try:
                measures = get_measures(dataset_id)
                measure_ids = [m["id"] for m in measures if m["id"] is not None]
                measure_map = {m["id"]: m["name"] for m in measures if m["id"] is not None}
                if not measure_ids:
                    print("‚ö† –ù–µ—Ç —Ä–∞–∑—Ä–µ–∑–æ–≤, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º")
                    continue
            except:
                continue
        else:
            measure_ids = [None]  # —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –∑–∞–ø—É—Å–∫

        # —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ dataset_id –∏ –Ω—É–∂–Ω—ã–º measureId
        if dataset_id in [30, 31, 32, 33]:
            measure_ids = [23, 42, 55, 64, 72, 87, 95, 106]
        elif dataset_id in [34, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54]:
            measure_ids = [22]
        # –æ—Å—Ç–∞–ª—å–Ω—ã–µ –æ—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ –µ—Å—Ç—å

        pub_map = {
            "–í —Ü–µ–ª–æ–º –ø–æ –†–æ—Å—Å–∏–π—Å–∫–æ–π –§–µ–¥–µ—Ä–∞—Ü–∏–∏": "–†—É—Å",
            "–í —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∞–ª—å–Ω–æ–º —Ä–∞–∑—Ä–µ–∑–µ": "–†–∞–∑",
            "–í —Ä–∞–∑—Ä–µ–∑–µ –ø–æ –≤–∏–¥–∞–º —ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–æ–π –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏": "–û—Ç—Ä",
            "–ü–æ –∫—Ä–µ–¥–∏—Ç–∞–º —Ñ–∏–∑–∏—á–µ—Å–∫–∏–º –ª–∏—Ü–∞–º": "–ö—Ä–µ–¥–§–õ",
            "–ü–æ –∏–ø–æ—Ç–µ—á–Ω—ã–º –∂–∏–ª–∏—â–Ω—ã–º –∫—Ä–µ–¥–∏—Ç–∞–º": "–ò–ø–æ—Ç",
            "–ü–æ –∫—Ä–µ–¥–∏—Ç–∞–º —é—Ä–∏–¥–∏—á–µ—Å–∫–∏–º –ª–∏—Ü–∞–º –∏ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–º –ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª—è–º (–≤ —Ç.—á. –ú–°–ü)": "–ö—Ä–µ–¥–Æ–õ–∏–ò–ü",
            "–ü–æ –∫—Ä–µ–¥–∏—Ç–∞–º —Å—É–±—ä–µ–∫—Ç–∞–º –ú–°–ü": "–ö—Ä–µ–¥–ú–°–ü",
            "–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–µ–Ω–µ–∂–Ω–æ–π –º–∞—Å—Å—ã": "–î–µ–Ω–ú–∞—Å",
            "–ö–ª—é—á–µ–≤—ã–µ –∞–≥—Ä–µ–≥–∞—Ç—ã": "–ö–ª–ê–≥—Ä",
            "–°—á–µ—Ç —Ç–µ–∫—É—â–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π": "–°–¢–û",
            "–°—á–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–π —Å –∫–∞–ø–∏—Ç–∞–ª–æ–º": "–°–û–ö",
            "–§–∏–Ω–∞–Ω—Å–æ–≤—ã–π —Å—á–µ—Ç": "–§–°",
            "–ß–∏—Å—Ç—ã–µ –æ—à–∏–±–∫–∏ –∏ –ø—Ä–æ–ø—É—Å–∫–∏": "–ß–û–ü",
            "–ù–æ–º–∏–Ω–∞–ª—å–Ω—ã–µ –∫—É—Ä—Å—ã –∏–Ω–æ—Å—Ç—Ä–∞–Ω–Ω—ã—Ö –≤–∞–ª—é—Ç –∫ —Ä—É–±–ª—é (—Ä—É–±–ª–µ–π –∑–∞ –µ–¥–∏–Ω–∏—Ü—É –∏–Ω–æ—Å—Ç—Ä–∞–Ω–Ω–æ–π –≤–∞–ª—é—Ç—ã) (–µ–∂–µ–º–µ—Å—è—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)": "–ù–ö–ò–∫–†_–º–µ—Å",
            "–ò–Ω–¥–µ–∫—Å—ã –æ–±–º–µ–Ω–Ω–æ–≥–æ –∫—É—Ä—Å–∞ —Ä—É–±–ª—è (–µ–∂–µ–º–µ—Å—è—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)": "–ò–Ω–û–ö–†—É–±_–º–µ—Å",
            "–ù–æ–º–∏–Ω–∞–ª—å–Ω—ã–µ –∫—É—Ä—Å—ã –∏–Ω–æ—Å—Ç—Ä–∞–Ω–Ω—ã—Ö –≤–∞–ª—é—Ç –∫ —Ä—É–±–ª—é (—Ä—É–±–ª–µ–π –∑–∞ –µ–¥–∏–Ω–∏—Ü—É –∏–Ω–æ—Å—Ç—Ä–∞–Ω–Ω–æ–π –≤–∞–ª—é—Ç—ã) (–µ–∂–µ–∫–≤–∞—Ä—Ç–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)": "–ù–ö–ò–∫–†_–µ–∂–∫",
            "–ò–Ω–¥–µ–∫—Å—ã –æ–±–º–µ–Ω–Ω–æ–≥–æ –∫—É—Ä—Å–∞ —Ä—É–±–ª—è (–µ–∂–µ–∫–≤–∞—Ä—Ç–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)": "–ò–Ω–û–ö–†—É–±_–µ–∂–∫",
            "–î–∞–Ω–Ω—ã–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –≤—Å–µ–≥–æ": "–î–ú",
            "–£—á–∞—Å—Ç–Ω–∏–∫–∏ –æ–ø—Ä–æ—Å–∞": "–£—á–û–ø—Ä",
            "–ö—Ä—É–ø–Ω—ã–µ": "–ö—Ä—É–ø",
            "–°—Ä–µ–¥–Ω–∏–µ": "–°—Ä–µ–¥",
            "–ú–∞–ª—ã–µ –∏ –º–∏–∫—Ä–æ": "–ú–∞–ª–ú–∏–∫"
        }

        meas_map = {
            "–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã–π –æ–∫—Ä—É–≥": "–¶–µ–Ω—Ç—Ä–û–∫—Ä",
            "–°–µ–≤–µ—Ä–æ-–ó–∞–ø–∞–¥–Ω—ã–π —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã–π –æ–∫—Ä—É–≥": "–°–µ–≤–ó–∞–ø–û–∫—Ä",
            "–Æ–∂–Ω—ã–π —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã–π –æ–∫—Ä—É–≥": "–Æ–∂–Ω–û–∫—Ä—É–≥",
            "–°–µ–≤–µ—Ä–æ-–ö–∞–≤–∫–∞–∑—Å–∫–∏–π —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã–π –æ–∫—Ä—É–≥": "–°–µ–≤–ö–∞–≤–û–∫—Ä",
            "–ü—Ä–∏–≤–æ–ª–∂—Å–∫–∏–π —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã–π –æ–∫—Ä—É–≥": "–ü—Ä–∏–≤–û–∫—Ä",
            "–£—Ä–∞–ª—å—Å–∫–∏–π —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã–π –æ–∫—Ä—É–≥": "–£—Ä–∞–ª–û–∫—Ä",
            "–°–∏–±–∏—Ä—Å–∫–∏–π —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã–π –æ–∫—Ä—É–≥": "–°–∏–±–û–∫—Ä",
            "–î–∞–ª—å–Ω–µ–≤–æ—Å—Ç–æ—á–Ω—ã–π —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã–π –æ–∫—Ä—É–≥": "–î–í–û–∫—Ä",
            "–†–æ—Å—Å–∏–π—Å–∫–∞—è –§–µ–¥–µ—Ä–∞—Ü–∏—è": "–†–§",
            "–ü—Ä–æ—á–µ–µ": "–ü—Ä–æ—á",
            "–í —Ä—É–±–ª—è—Ö": "—Ä—É–±",
            "–í –¥–æ–ª–ª–∞—Ä–∞—Ö –°–®–ê": "–¥–æ–ª",
            "–í –µ–≤—Ä–æ": "–µ–≤—Ä",
            "A. –°–µ–ª—å—Å–∫–æ–µ, –ª–µ—Å–Ω–æ–µ —Ö–æ–∑—è–π—Å—Ç–≤–æ, –æ—Ö–æ—Ç–∞, —Ä—ã–±–æ–ª–æ–≤—Å—Ç–≤–æ –∏ —Ä—ã–±–æ–≤–æ–¥—Å—Ç–≤–æ": "A–°–µ–ª–ª",
            "B. –î–æ–±—ã—á–∞ –ø–æ–ª–µ–∑–Ω—ã—Ö –∏—Å–∫–æ–ø–∞–µ–º—ã—Ö": "–î–æ–±—ã—á",
            "C. –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—â–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞": "–û–±—Ä–∞–±",
            "D. –û–±–µ—Å–ø–µ—á–µ–Ω–∏–µ —ç–ª–µ–∫—Ç—Ä–∏—á–µ—Å–∫–æ–π —ç–Ω–µ—Ä–≥–∏–µ–π, –≥–∞–∑–æ–º –∏ –ø–∞—Ä–æ–º; –∫–æ–Ω–¥–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–æ–∑–¥—É—Ö–∞": "–≠–Ω–µ—Ä–≥",
            "E. –í–æ–¥–æ—Å–Ω–∞–±–∂–µ–Ω–∏–µ; –≤–æ–¥–æ–æ—Ç–≤–µ–¥–µ–Ω–∏–µ, –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è —Å–±–æ—Ä–∞ –∏ —É—Ç–∏–ª–∏–∑–∞—Ü–∏–∏ –æ—Ç—Ö–æ–¥–æ–≤, –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–æ –ª–∏–∫–≤–∏–¥–∞—Ü–∏–∏ –∑–∞–≥—Ä—è–∑–Ω–µ–Ω–∏–π": "–í–æ–¥–≤",
            "F. –°—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ": "–°—Ç—Ä–æ–π",
            "G. –¢–æ—Ä–≥–æ–≤–ª—è –æ–ø—Ç–æ–≤–∞—è –∏ —Ä–æ–∑–Ω–∏—á–Ω–∞—è; —Ä–µ–º–æ–Ω—Ç –∞–≤—Ç–æ—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ã—Ö —Å—Ä–µ–¥—Å—Ç–≤ –∏ –º–æ—Ç–æ—Ü–∏–∫–ª–æ–≤": "–¢–æ—Ä–≥",
            "H. –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –∏ —Ö—Ä–∞–Ω–µ–Ω–∏–µ": "–¢—Ä–∞–Ω",
            "I. –î–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≥–æ—Å—Ç–∏–Ω–∏—Ü –∏ –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–π –æ–±—â–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –ø–∏—Ç–∞–Ω–∏—è": "–ì–æ—Ç",
            "J. –î–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤ –æ–±–ª–∞—Å—Ç–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∏ —Å–≤—è–∑–∏": "–ò–Ω—Ñ",
            "L. –î–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–æ –æ–ø–µ—Ä–∞—Ü–∏—è–º —Å –Ω–µ–¥–≤–∏–∂–∏–º—ã–º –∏–º—É—â–µ—Å—Ç–≤–æ–º": "–ù–µ–¥–≤",
            "M. –î–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è, –Ω–∞—É—á–Ω–∞—è –∏ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è": "–ü—Ä–æ—Ñ",
            "P. –û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ": "–û–±—Ä",
            "R. –î–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤ –æ–±–ª–∞—Å—Ç–∏ –∫—É–ª—å—Ç—É—Ä—ã, —Å–ø–æ—Ä—Ç–∞, –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –¥–æ—Å—É–≥–∞ –∏ —Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏–π": "–ö—É–ª—å—Ç",
            "–í —Ü–µ–ª–æ–º –ø–æ –†–æ—Å—Å–∏–π—Å–∫–æ–π –§–µ–¥–µ—Ä–∞—Ü–∏–∏": "–†—É—Å",
            "–í % –ø—Ä–∏—Ä–æ—Å—Ç–∞ –∫ –¥–µ–∫–∞–±—Ä—é –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –≥–æ–¥–∞": "%–¥–µ–∫-Y",
            "–í % –ø—Ä–∏—Ä–æ—Å—Ç–∞ –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É –ø–µ—Ä–∏–æ–¥—É": "%-–ü–µ—Ä",
            "–í % –ø—Ä–∏—Ä–æ—Å—Ç–∞ –∫ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–º—É –ø–µ—Ä–∏–æ–¥—É –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –≥–æ–¥–∞": "%-–≥–≥",
            "–ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ": "–ò—Å—Ö",
            "–°–µ–∑–æ–Ω–Ω–æ —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ": "–°–µ–∑–°–∫–æ—Ä",
            "–≠–∫–æ–Ω–æ–º–∏–∫–∞": "–≠–∫–æ–Ω",
            "–ü—Ä–æ–º—ã—à–ª–µ–Ω–Ω–æ–µ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ": "–ü—Ä–æ–º",
            "–î–æ–±—ã—á–∞ –ø–æ–ª–µ–∑–Ω—ã—Ö –∏—Å–∫–æ–ø–∞–µ–º—ã—Ö": "–î–æ–±—ã—á",
            "–û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—â–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞": "–û–±—Ä–∞–±",
            "–°–µ–ª—å—Å–∫–æ–µ, –ª–µ—Å–Ω–æ–µ —Ö–æ–∑—è–π—Å—Ç–≤–æ, –æ—Ö–æ—Ç–∞, —Ä—ã–±–æ–ª–æ–≤—Å—Ç–≤–æ –∏ —Ä—ã–±–æ–≤–æ–¥—Å—Ç–≤–æ": "–°–•",
            "–°—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ": "–°—Ç—Ä–æ–π",
            "–¢–æ—Ä–≥–æ–≤–ª—è –æ–ø—Ç–æ–≤–∞—è –∏ —Ä–æ–∑–Ω–∏—á–Ω–∞—è, —Ä–µ–º–æ–Ω—Ç –∞–≤—Ç–æ—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ã—Ö —Å—Ä–µ–¥—Å—Ç–≤ –∏ –º–æ—Ç–æ—Ü–∏–∫–ª–æ–≤": "–¢–æ—Ä–≥",
            "–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –∏ —Ö—Ä–∞–Ω–µ–Ω–∏–µ": "–¢—Ä–∞–Ω–•—Ä–∞–Ω",
            "–£—Å–ª—É–≥–∏": "–£—Å–ª—É–≥–∏"
        }

        for measure_id in measure_ids:
            meas_abbr_raw = "" if measure_id is None else measure_map.get(measure_id, "")
            meas_abbr = meas_map.get(meas_abbr_raw, meas_abbr_raw)  # –∏—Å–ø–æ–ª—å–∑—É–µ–º meas_map, –µ—Å–ª–∏ –º–æ–∂–µ–º
            meas_short = meas_abbr if meas_abbr else ""

            pub_short = pub_map.get(pub_name, abbr(pub_name))
            dataset_short = dataset_map.get(dataset_name, abbr(dataset_name))

            name_parts = [pub_short, dataset_short]
            if meas_short:
                name_parts.append(meas_short)

            # –û–≥—Ä–∞–Ω–∏—á–∏–º –¥–ª–∏–Ω—É –∫–∞–∂–¥–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –¥–æ 12 —Å–∏–º–≤–æ–ª–æ–≤, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –ø–æ–≤—Ç–æ—Ä–æ–≤
            name_parts_trimmed = [part[:12] for part in name_parts]
            table_alias = "_".join(name_parts_trimmed)

            safe_suffix = "all" if measure_id is None else f"m{measure_id}"
            table_name = f"pub{pub_id}_ds{dataset_id}_{safe_suffix}"

            try:
                data_json = get_data(YEAR_FROM, YEAR_TO, dataset_id, pub_id, measure_id)
                raw = data_json.get("RawData", [])
                headers = data_json.get("headerData", [])
                units = data_json.get("units", [])
                df = pd.DataFrame(raw)

                if df.empty:
                    print(f"‚ö† –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö (measureId={measure_id})")
                    continue

                # –†–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞
                element_map = {h["id"]: h.get("elname", "") for h in headers}
                unit_map = {u["id"]: u.get("val", "") for u in units}

                df["indicator_name"] = headers[0]["elname"] if headers else dataset_name
                if "element_id" in df.columns:
                    df["element_name"] = df["element_id"].map(element_map)
                if "measure_id" in df.columns and measure_map:
                    df["measure_name"] = df["measure_id"].map(measure_map)
                if "unit_id" in df.columns:
                    df["unit_name"] = df["unit_id"].map(unit_map)

                # –î–æ–±–∞–≤–ª—è–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ, —á—Ç–æ–±—ã —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç –≤—ã–≥—Ä—É–∑–∫–∏
                df["publication_id"] = pub_id
                df["publication_name"] = pub_name
                df["dataset_id"] = dataset_id
                df["dataset_name"] = dataset_name
                df["measure_id_requested"] = measure_id
                df["table_alias"] = table_alias

                if "obs_val" in df.columns:
                    df = df[[col for col in df.columns if col != "obs_val"] + ["obs_val"]]

                file_name = f"{table_name}.parquet"
                file_path = output_dir / file_name

                if table_name in saved_files and file_path.exists():
                    existing_df = pd.read_parquet(file_path)
                    df = pd.concat([existing_df, df], ignore_index=True)
                else:
                    saved_files.add(table_name)
                    metadata_rows.append({
                        "table_name": table_name,
                        "file_name": file_name,
                        "table_alias": table_alias,
                        "publication_id": pub_id,
                        "publication_name": pub_name,
                        "dataset_id": dataset_id,
                        "dataset_name": dataset_name,
                        "measure_id": measure_id,
                        "measure_name": meas_abbr_raw
                    })

                df.to_parquet(file_path, index=False)

                print(f"‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ: {file_name}")

            except Exception as e:
                print(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ ID={dataset_id}, measureId={measure_id}: {e}")

if metadata_rows:
    metadata_df = pd.DataFrame(metadata_rows)
    metadata_df.to_parquet(output_dir / "metadata.parquet", index=False)

print(f"\nüìÅ –ì–æ—Ç–æ–≤–æ! –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ –∫–∞—Ç–∞–ª–æ–≥–µ {output_dir.resolve()}")



import pandas as pd
from pathlib import Path

parquet_dir = Path("cbr_parquet")
all_frames = [pd.read_parquet(p) for p in parquet_dir.glob("*.parquet") if p.name != "metadata.parquet"]
combined = pd.concat(all_frames, ignore_index=True)
combined.to_parquet("cbr_parquet/all_data.parquet", index=False)



import pandas as pd
import pyodbc
from datetime import datetime
from pathlib import Path

PARQUET_FILE = Path("cbr_parquet/all_data.parquet")
TARGET_TABLE = "u_m26pu.cbr_all_data"
DSN_NAME = "impala51"          # –∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Å–≤–æ–π DSN
BATCH_SIZE = 10_000            # –º–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å –ø–æ–¥ –æ–±—ä—ë–º

# –µ—Å–ª–∏ —Ö–æ—Ç–∏–º –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å—Å—è –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–º–∏ –∫–æ–ª–æ–Ω–∫–∞–º–∏ ‚Äî –ø–µ—Ä–µ—á–∏—Å–ª–∏—Ç–µ –∏—Ö –∑–¥–µ—Å—å
required_columns = [
    "publication_id",
    "publication_name",
    "dataset_id",
    "dataset_name",
    "measure_id_requested",
    "obs_val",
    "time",
    "indicator_name",
    "element_name",
    "measure_name",
    "unit_name",
]

def load_data_to_hadoop():
    try:
        print(f"[{datetime.now()}] –ù–∞—á–∞–ª–æ —á—Ç–µ–Ω–∏—è Parquet: {PARQUET_FILE}")
        df = pd.read_parquet(PARQUET_FILE)

        missing = [col for col in required_columns if col not in df.columns]
        if missing:
            raise ValueError(f"–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –∫–æ–ª–æ–Ω–∫–∏: {missing}")

        df = df.fillna("")  # –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Å–≤–æ–∏ –ø—Ä–∞–≤–∏–ª–∞ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è

        print(f"[{datetime.now()}] –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Impala (DSN={DSN_NAME})")
        conn = pyodbc.connect(
            f"DSN={DSN_NAME};",
            autocommit=True,
            ansi=True,
            timeout=0,
        )
        cursor = conn.cursor()

        # —Å–æ–∑–¥–∞—ë–º —Ç–∞–±–ª–∏—Ü—É (–≤—Å–µ –ø–æ–ª—è –∫–∞–∫ STRING ‚Äî –ø–æ–¥—Å—Ç—Ä–æ–π—Ç–µ —Ç–∏–ø—ã –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏)
        column_defs = ",\n    ".join(f"`{col}` STRING" for col in required_columns)
        cursor.execute(f"""
            CREATE TABLE IF NOT EXISTS {TARGET_TABLE} (
                {column_defs}
            )
            STORED AS PARQUET
            TBLPROPERTIES ('transactional'='false', 'parquet.compression'='SNAPPY')
        """)
        print(f"[{datetime.now()}] –¢–∞–±–ª–∏—Ü–∞ –ø—Ä–æ–≤–µ—Ä–µ–Ω–∞/—Å–æ–∑–¥–∞–Ω–∞")

        total_rows = len(df)
        inserted_rows = 0
        print(f"[{datetime.now()}] –°—Ç–∞—Ä—Ç –∑–∞–≥—Ä—É–∑–∫–∏: {total_rows} —Å—Ç—Ä–æ–∫...")

        for start in range(0, total_rows, BATCH_SIZE):
            end = min(start + BATCH_SIZE, total_rows)
            batch = df.loc[start:end - 1, required_columns]

            placeholders = ", ".join(["?"] * len(required_columns))
            data = [tuple(row) for row in batch.itertuples(index=False, name=None)]

            try:
                cursor.fast_executemany = True
                cursor.executemany(
                    f"INSERT INTO {TARGET_TABLE} VALUES ({placeholders})",
                    data,
                )
                inserted_rows += len(data)
                print(f"[{datetime.now()}] –ó–∞–≥—Ä—É–∂–µ–Ω–æ: {inserted_rows}/{total_rows}")
            except pyodbc.Error as e:
                print(f"[{datetime.now()}] –û—à–∏–±–∫–∞ –ø–∞–∫–µ—Ç–∞ {start}-{end}: {e}")
                with open("error_batch.txt", "a", encoding="utf-8") as err:
                    err.write(f"{datetime.now()} ‚Äî –ø–∞–∫–µ—Ç {start}-{end}: {e}\n")
                    batch.to_csv(err, sep="\t", index=False)
                continue

        print(f"[{datetime.now()}] –£—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ {inserted_rows} —Å—Ç—Ä–æ–∫")

    except Exception as e:
        print(f"[{datetime.now()}] –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: {e}")
    finally:
        if 'cursor' in locals():
            cursor.close()
        if 'conn' in locals():
            conn.close()
        print(f"[{datetime.now()}] –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–æ")

if __name__ == "__main__":
    load_data_to_hadoop()


import pandas as pd
import pyodbc
from datetime import datetime
from pathlib import Path

PARQUET_FILE = Path("cbr_parquet/all_data.parquet")
TARGET_TABLE = "u_m26pu.cbr_all_data"   # –ø–æ–º–µ–Ω—è–π—Ç–µ –Ω–∞ —Å–≤–æ—é –ë–î.—Ç–∞–±–ª–∏—Ü—É
DSN_NAME = "impala51"                   # –∏–º—è ODBC-DSN –¥–ª—è Impala
BATCH_SIZE = 10_000                     # —Ä–∞–∑–º–µ—Ä –ø–∞—á–∫–∏ –¥–ª—è executemany

# –ø–µ—Ä–µ—á–µ–Ω—å –∫–æ–ª–æ–Ω–æ–∫ –∏ –∏—Ö —Ç–∏–ø—ã –≤ Impala
column_types = {
    "publication_id": "STRING",
    "publication_name": "STRING",
    "dataset_id": "STRING",
    "dataset_name": "STRING",
    "measure_id_requested": "STRING",
    "obs_val": "DOUBLE",                # —á–∏—Å–ª–æ–≤–æ–π —Ç–∏–ø –¥–ª—è –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è
    "time": "STRING",
    "indicator_name": "STRING",
    "element_name": "STRING",
    "measure_name": "STRING",
    "unit_name": "STRING",
}
required_columns = list(column_types)


def load_data_to_hadoop():
    try:
        print(f"[{datetime.now()}] –ß—Ç–µ–Ω–∏–µ Parquet: {PARQUET_FILE}")
        df = pd.read_parquet(PARQUET_FILE)

        missing = [col for col in required_columns if col not in df.columns]
        if missing:
            raise ValueError(f"–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –∫–æ–ª–æ–Ω–∫–∏: {missing}")

        # obs_val ‚Üí numeric (–Ω–µ—Å—á–∏—Ç—ã–≤–∞–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è —Å—Ç–∞–Ω—É—Ç NaN)
        df["obs_val"] = pd.to_numeric(df["obs_val"], errors="coerce")

        # —Å—Ç—Ä–æ–∫–æ–≤—ã–µ –ø–æ–ª—è ‚Üí —Å—Ç—Ä–æ–∫–∏ –±–µ–∑ NaN
        string_cols = [col for col, typ in column_types.items() if typ == "STRING"]
        df[string_cols] = df[string_cols].apply(lambda s: s.fillna("").astype(str))

        print(f"[{datetime.now()}] –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Impala (DSN={DSN_NAME})")
        conn = pyodbc.connect(
            f"DSN={DSN_NAME};",
            autocommit=True,
            ansi=True,
            timeout=0,
        )
        cursor = conn.cursor()

        column_defs = ",\n    ".join(
            f"`{col}` {column_types[col]}" for col in required_columns
        )
        cursor.execute(f"""
            CREATE TABLE IF NOT EXISTS {TARGET_TABLE} (
                {column_defs}
            )
            STORED AS PARQUET
            TBLPROPERTIES ('transactional'='false', 'parquet.compression'='SNAPPY')
        """)
        print(f"[{datetime.now()}] –¢–∞–±–ª–∏—Ü–∞ –≥–æ—Ç–æ–≤–∞")

        total_rows = len(df)
        inserted_rows = 0
        print(f"[{datetime.now()}] –°—Ç–∞—Ä—Ç –∑–∞–≥—Ä—É–∑–∫–∏: {total_rows} —Å—Ç—Ä–æ–∫")

        for start in range(0, total_rows, BATCH_SIZE):
            end = min(start + BATCH_SIZE, total_rows)
            batch = df.iloc[start:end][required_columns]

            placeholders = ", ".join(["?"] * len(required_columns))
            data = [tuple(row) for row in batch.itertuples(index=False, name=None)]

            try:
                cursor.fast_executemany = True
                cursor.executemany(
                    f"INSERT INTO {TARGET_TABLE} VALUES ({placeholders})",
                    data,
                )
                inserted_rows += len(data)
                print(f"[{datetime.now()}] –ó–∞–≥—Ä—É–∂–µ–Ω–æ {inserted_rows}/{total_rows}")
            except pyodbc.Error as e:
                print(f"[{datetime.now()}] –û—à–∏–±–∫–∞ –ø–∞–∫–µ—Ç–∞ {start}-{end}: {e}")
                with open("error_batch.txt", "a", encoding="utf-8") as err:
                    err.write(f"{datetime.now()} ‚Äî –ø–∞–∫–µ—Ç {start}-{end}: {e}\n")
                    batch.to_csv(err, sep="\t", index=False)
                continue

        print(f"[{datetime.now()}] –£—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ {inserted_rows} —Å—Ç—Ä–æ–∫")

    except Exception as e:
        print(f"[{datetime.now()}] –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: {e}")
    finally:
        if 'cursor' in locals():
            cursor.close()
        if 'conn' in locals():
            conn.close()
        print(f"[{datetime.now()}] –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–æ")


if __name__ == "__main__":
    load_data_to_hadoop()
